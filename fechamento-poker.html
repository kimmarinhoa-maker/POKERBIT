<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fechamento Semanal · Poker Manager</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap');
:root{
  --bg:#0d1117;--sb:#0a0d13;--s1:#161b27;--s2:#1c2333;--s3:#222d42;
  --b1:#21293d;--b2:#2a3550;
  --gold:#f0b429;--gold-d:rgba(240,180,41,.12);--gold-b:rgba(240,180,41,.22);
  --green:#10b981;--green-d:rgba(16,185,129,.1);
  --red:#ef4444;--red-d:rgba(239,68,68,.1);
  --blue:#3b82f6;--teal:#14b8a6;--purple:#a855f7;
  --t1:#e2e8f0;--t2:#94a3b8;--t3:#4a5568;
  --sw:240px;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Outfit',sans-serif;background:var(--bg);color:var(--t1);min-height:100vh;display:flex;overflow:hidden;}

/* ── SIDEBAR ── */
.sidebar{width:var(--sw);background:var(--sb);border-right:1px solid var(--b1);display:flex;flex-direction:column;position:fixed;top:0;left:0;bottom:0;z-index:50;}
.sb-logo{padding:22px 20px 18px;border-bottom:1px solid var(--b1);}
.logo-mark{display:flex;align-items:center;gap:10px;}
.logo-icon{width:34px;height:34px;background:linear-gradient(135deg,var(--gold),#c47d00);border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:17px;box-shadow:0 4px 14px rgba(240,180,41,.3);}
.logo-txt{font-size:.95rem;font-weight:700;letter-spacing:-.3px;}
.logo-txt span{color:var(--gold);}
.sb-sec{padding:18px 12px 6px;}
.sb-sec-lbl{font-size:.62rem;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;color:var(--t3);padding:0 8px;margin-bottom:8px;}
.nav-item{display:flex;align-items:center;gap:9px;padding:9px 12px;border-radius:8px;cursor:pointer;font-size:.845rem;font-weight:500;color:var(--t2);margin-bottom:2px;transition:all .15s;border:1px solid transparent;}
.nav-item:hover{background:var(--s2);color:var(--t1);}
.nav-item.active{background:var(--gold-d);color:var(--gold);border-color:rgba(240,180,41,.2);}
.nav-item .ni{font-size:.9rem;width:18px;text-align:center;}
.nav-item .nav-badge{margin-left:auto;background:var(--s3);border-radius:9px;padding:1px 7px;font-size:.68rem;font-family:'JetBrains Mono',monospace;color:var(--t3);}
.nav-item.active .nav-badge{background:rgba(240,180,41,.2);color:var(--gold);}
.sb-bottom{margin-top:auto;padding:14px 12px;border-top:1px solid var(--b1);}
.week-pill-sb{background:var(--s2);border:1px solid var(--b2);border-radius:8px;padding:9px 12px;}
.week-pill-sb .wv{font-family:'JetBrains Mono',monospace;color:var(--gold);font-weight:600;display:block;margin-top:2px;font-size:.77rem;}
.week-pill-sb .wlbl{font-size:.65rem;color:var(--t3);text-transform:uppercase;letter-spacing:1px;font-weight:700;}

/* ── MAIN ── */
.main{margin-left:var(--sw);flex:1;display:flex;flex-direction:column;height:100vh;overflow-y:auto;}
.topbar{background:var(--sb);border-bottom:1px solid var(--b1);padding:14px 28px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:40;}
.topbar-title{font-size:.95rem;font-weight:600;}
.topbar-title span{color:var(--t2);font-weight:400;}
.topbar-right{display:flex;align-items:center;gap:10px;}
.status-dot{width:7px;height:7px;border-radius:50%;background:var(--green);box-shadow:0 0 7px var(--green);animation:blink 2s infinite;}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}

.content{padding:28px 28px 50px;flex:1;}

/* ── STEP 1: IMPORT GERAL ── */
.import-hero{background:var(--s1);border:1px solid var(--b1);border-radius:16px;padding:40px;margin-bottom:24px;}
.import-hero-header{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:32px;}
.import-hero-title{font-size:1.5rem;font-weight:800;letter-spacing:-.5px;line-height:1.2;}
.import-hero-title span{color:var(--gold);}
.import-hero-sub{color:var(--t2);font-size:.875rem;margin-top:6px;line-height:1.5;}

/* WEEK SELECTOR */
.week-section{margin-bottom:32px;}
.sec-lbl{font-size:.68rem;font-weight:700;text-transform:uppercase;letter-spacing:1.4px;color:var(--t3);margin-bottom:12px;}
.week-row{display:flex;align-items:center;gap:10px;margin-bottom:12px;}
.week-nav-btn{width:36px;height:36px;border-radius:8px;background:var(--s2);border:1px solid var(--b2);color:var(--t1);font-size:1rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s;}
.week-nav-btn:hover{border-color:var(--gold);color:var(--gold);}
.week-display{background:var(--s2);border:1px solid var(--b2);border-radius:9px;padding:9px 20px;font-family:'JetBrains Mono',monospace;font-size:.875rem;font-weight:600;color:var(--gold);min-width:240px;text-align:center;}
.week-chips{display:flex;flex-wrap:wrap;gap:6px;}
.wchip{background:var(--s2);border:1px solid var(--b1);border-radius:16px;padding:5px 12px;font-size:.71rem;font-family:'JetBrains Mono',monospace;cursor:pointer;color:var(--t2);transition:all .18s;}
.wchip:hover{border-color:var(--b2);color:var(--t1);}
.wchip.active{border-color:var(--gold);color:var(--gold);background:var(--gold-d);}

/* DROP ZONE */
.drop-section{margin-bottom:28px;}
.drop-zone{border:2px dashed var(--b2);border-radius:14px;padding:48px 32px;text-align:center;cursor:pointer;transition:all .25s;background:var(--s2);}
.drop-zone:hover,.drop-zone.drag-over{border-color:var(--gold);background:rgba(240,180,41,.04);}
.drop-zone.loaded{border-color:var(--green);background:rgba(16,185,129,.04);}
.drop-icon{font-size:2.8rem;margin-bottom:14px;display:block;}
.drop-title{font-size:1.05rem;font-weight:700;margin-bottom:6px;}
.drop-sub{font-size:.82rem;color:var(--t3);line-height:1.6;}
.drop-formats{display:inline-block;margin-top:14px;background:var(--s1);border:1px solid var(--b2);padding:5px 14px;border-radius:18px;font-size:.73rem;color:var(--gold);font-family:'JetBrains Mono',monospace;}
.drop-btn{display:inline-flex;align-items:center;gap:7px;margin-top:18px;background:linear-gradient(135deg,var(--gold),#c47d00);color:#000;border:none;padding:11px 28px;border-radius:9px;font-family:'Outfit',sans-serif;font-weight:700;font-size:.875rem;cursor:pointer;box-shadow:0 4px 16px rgba(240,180,41,.25);transition:all .2s;}
.drop-btn:hover{transform:translateY(-1px);box-shadow:0 6px 24px rgba(240,180,41,.35);}

/* COL MAPPER */
.mapper-card{background:var(--s2);border:1px solid var(--b2);border-radius:12px;padding:20px 22px;margin-bottom:22px;display:none;}
.mapper-card.show{display:block;animation:fadeIn .3s ease;}
.mapper-title{font-size:.88rem;font-weight:700;margin-bottom:4px;}
.mapper-sub{font-size:.78rem;color:var(--t2);margin-bottom:18px;}
.cm-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(185px,1fr));gap:10px;margin-bottom:18px;}
.cm-field label{display:block;font-size:.67rem;font-weight:700;text-transform:uppercase;letter-spacing:.8px;color:var(--t3);margin-bottom:5px;}
.cm-field select{width:100%;background:var(--s3);border:1px solid var(--b2);color:var(--t1);padding:7px 9px;border-radius:7px;font-family:'Outfit',sans-serif;font-size:.8rem;cursor:pointer;}
.cm-field select:focus{outline:none;border-color:var(--gold);}

.btn-primary{background:linear-gradient(135deg,var(--gold),#c47d00);color:#000;border:none;padding:11px 26px;border-radius:9px;font-family:'Outfit',sans-serif;font-weight:700;font-size:.875rem;cursor:pointer;display:inline-flex;align-items:center;gap:7px;box-shadow:0 4px 16px rgba(240,180,41,.25);transition:all .2s;}
.btn-primary:hover{transform:translateY(-1px);}
.btn-primary:disabled{opacity:.35;pointer-events:none;}
.btn-sec{background:transparent;color:var(--t2);border:1px solid var(--b2);padding:11px 20px;border-radius:9px;font-family:'Outfit',sans-serif;font-size:.875rem;cursor:pointer;transition:all .2s;}
.btn-sec:hover{border-color:var(--t2);color:var(--t1);}

/* ── OVERVIEW: ALL CLUBS ── */
.overview-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;}
.overview-title{font-size:1.3rem;font-weight:800;letter-spacing:-.4px;}
.overview-title span{color:var(--gold);}
.overview-week{font-family:'JetBrains Mono',monospace;font-size:.82rem;color:var(--t2);background:var(--s2);border:1px solid var(--b2);padding:6px 14px;border-radius:20px;}

.overview-kpis{display:grid;grid-template-columns:repeat(4,1fr);gap:13px;margin-bottom:24px;}
.ok-card{background:var(--s1);border:1px solid var(--b1);border-radius:12px;padding:16px 18px;position:relative;overflow:hidden;}
.ok-card::after{content:'';position:absolute;top:0;left:0;right:0;height:2px;}
.ok-card.g::after{background:var(--gold);}
.ok-card.gr::after{background:var(--green);}
.ok-card.r::after{background:var(--red);}
.ok-card.b::after{background:var(--blue);}
.ok-lbl{font-size:.67rem;font-weight:700;text-transform:uppercase;letter-spacing:.9px;color:var(--t3);margin-bottom:7px;}
.ok-val{font-family:'JetBrains Mono',monospace;font-size:1.2rem;font-weight:700;letter-spacing:-.5px;}
.ok-val.g{color:var(--gold);}
.ok-val.gr{color:var(--green);}
.ok-val.r{color:var(--red);}
.ok-val.b{color:var(--blue);}

/* CLUB CARDS OVERVIEW */
.clubs-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px;margin-bottom:28px;}
.club-ov-card{background:var(--s1);border:1px solid var(--b1);border-radius:14px;padding:20px;cursor:pointer;transition:all .2s;position:relative;overflow:hidden;}
.club-ov-card::before{content:'';position:absolute;top:0;left:0;bottom:0;width:3px;}
.club-ov-card.imperio::before{background:var(--gold);}
.club-ov-card.confraria::before{background:var(--green);}
.club-ov-card.tbet::before{background:var(--purple);}
.club-ov-card.tgp::before{background:#fb923c;}
.club-ov-card.ch::before{background:var(--blue);}
.club-ov-card:hover{border-color:var(--b2);transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,0,0,.3);}
.coc-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;}
.coc-name{display:flex;align-items:center;gap:9px;font-size:1rem;font-weight:700;}
.coc-count{font-family:'JetBrains Mono',monospace;font-size:.75rem;color:var(--t3);background:var(--s2);padding:3px 9px;border-radius:10px;}
.coc-stats{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:14px;}
.coc-stat{background:var(--s2);border-radius:8px;padding:9px 11px;}
.coc-stat-lbl{font-size:.64rem;font-weight:600;text-transform:uppercase;letter-spacing:.7px;color:var(--t3);margin-bottom:4px;}
.coc-stat-val{font-family:'JetBrains Mono',monospace;font-size:.88rem;font-weight:600;}
.coc-action{display:flex;align-items:center;justify-content:space-between;}
.coc-btn{background:var(--s2);border:1px solid var(--b2);color:var(--t2);padding:7px 14px;border-radius:7px;font-family:'Outfit',sans-serif;font-size:.78rem;font-weight:600;cursor:pointer;transition:all .2s;}
.coc-btn:hover{color:var(--t1);border-color:var(--t2);}
.coc-unlinked{font-size:.73rem;color:var(--red);display:flex;align-items:center;gap:4px;}
.coc-unlinked.ok{color:var(--green);}

/* ── DETAIL VIEW (per club) ── */
.detail-layout{display:grid;grid-template-columns:210px 1fr;gap:18px;}
.detail-nav{background:var(--s1);border:1px solid var(--b1);border-radius:13px;padding:14px;height:fit-content;position:sticky;top:20px;}
.dn-title{font-size:.62rem;font-weight:700;text-transform:uppercase;letter-spacing:1.4px;color:var(--t3);margin-bottom:10px;}
.dn-item{display:flex;align-items:center;gap:8px;padding:9px 10px;border-radius:7px;cursor:pointer;font-size:.82rem;color:var(--t2);transition:all .15s;margin-bottom:2px;border:1px solid transparent;}
.dn-item:hover{background:var(--s2);color:var(--t1);}
.dn-item.active{background:var(--gold-d);color:var(--gold);border-color:rgba(240,180,41,.2);}
.dn-item .dnc{margin-left:auto;background:var(--s3);border-radius:9px;padding:1px 7px;font-size:.67rem;font-family:'JetBrains Mono',monospace;color:var(--t3);}
.dn-item.active .dnc{background:rgba(240,180,41,.2);color:var(--gold);}
.rb-itab{background:var(--s2);border:1px solid var(--b1);color:var(--t2);padding:6px 16px;border-radius:7px;font-size:.75rem;font-weight:600;cursor:pointer;transition:all .15s;font-family:'Outfit',sans-serif;}
.rb-itab:hover{color:var(--t1);border-color:var(--b2);}
.rb-itab.rb-itab-active{background:var(--gold-d);color:var(--gold);border-color:rgba(240,180,41,.25);}

.detail-content{background:var(--s1);border:1px solid var(--b1);border-radius:13px;padding:22px;min-height:500px;}
.dc-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;padding-bottom:16px;border-bottom:1px solid var(--b1);}
.dc-clube{display:flex;align-items:center;gap:12px;}
.dc-icon{width:44px;height:44px;border-radius:11px;background:var(--gold-d);border:2px solid rgba(240,180,41,.3);display:flex;align-items:center;justify-content:center;font-size:1.4rem;}
.dc-name{font-size:1.15rem;font-weight:700;}
.dc-week{font-size:.74rem;color:var(--t2);margin-top:2px;font-family:'JetBrains Mono',monospace;}
.dc-actions{display:flex;align-items:center;gap:8px;}
.back-btn{background:var(--s2);border:1px solid var(--b2);color:var(--t2);padding:7px 13px;border-radius:7px;cursor:pointer;font-size:.78rem;font-family:'Outfit',sans-serif;transition:all .2s;display:flex;align-items:center;gap:5px;}
.back-btn:hover{border-color:var(--t2);color:var(--t1);}

.sub-tab{display:none;}
.sub-tab.active{display:block;animation:fadeIn .25s ease;}
@keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}

/* KPI ROW */
.kpi-row{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:20px;}
.km{background:var(--s2);border:1px solid var(--b1);border-radius:11px;padding:13px;position:relative;overflow:hidden;}
.km::after{content:'';position:absolute;top:0;left:0;right:0;height:2px;}
.km.g::after{background:var(--gold);}
.km.gr::after{background:var(--green);}
.km.r::after{background:var(--red);}
.km.b::after{background:var(--blue);}
.km-lbl{font-size:.64rem;font-weight:700;text-transform:uppercase;letter-spacing:.8px;color:var(--t3);margin-bottom:6px;}
.km-val{font-family:'JetBrains Mono',monospace;font-size:1.05rem;font-weight:600;}
.km-val.g{color:var(--gold);}
.km-val.gr{color:var(--green);}
.km-val.r{color:var(--red);}
.km-val.b{color:var(--blue);}

/* TOOLBAR */
.toolbar{display:flex;align-items:center;justify-content:space-between;margin-bottom:13px;gap:8px;flex-wrap:wrap;}
.tl{display:flex;align-items:center;gap:7px;}
.tr{display:flex;align-items:center;gap:7px;}
.search-box{background:var(--s2);border:1px solid var(--b2);color:var(--t1);padding:7px 12px;border-radius:8px;font-family:'Outfit',sans-serif;font-size:.8rem;width:180px;}
.search-box:focus{outline:none;border-color:var(--gold);}
.search-box::placeholder{color:var(--t3);}
.fsel{background:var(--s2);border:1px solid var(--b2);color:var(--t2);padding:7px 9px;border-radius:8px;font-family:'Outfit',sans-serif;font-size:.79rem;cursor:pointer;}
.fsel:focus{outline:none;border-color:var(--gold);}
.btn-sm{background:var(--s2);border:1px solid var(--b2);color:var(--t2);padding:7px 12px;border-radius:7px;font-family:'Outfit',sans-serif;font-size:.77rem;cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:5px;}
.btn-sm:hover{border-color:var(--gold);color:var(--gold);}

.unl-bar{background:rgba(239,68,68,.07);border:1px solid rgba(239,68,68,.2);border-radius:9px;padding:10px 14px;margin-bottom:12px;display:flex;align-items:center;justify-content:space-between;}
.unl-txt{font-size:.8rem;color:var(--red);display:flex;align-items:center;gap:7px;}
.btn-link-all{background:var(--red);color:#fff;border:none;padding:6px 13px;border-radius:7px;font-family:'Outfit',sans-serif;font-weight:600;font-size:.76rem;cursor:pointer;}
.btn-link-all:hover{filter:brightness(1.1);}

/* TABLE */
.tw{overflow-x:auto;}
table{width:100%;border-collapse:collapse;min-width:1050px;}
thead{background:rgba(20,29,47,.9);}
th{padding:9px 11px;font-size:.63rem;font-weight:700;text-transform:uppercase;letter-spacing:.8px;color:var(--t3);text-align:left;white-space:nowrap;border-bottom:1px solid var(--b1);}
td{padding:8px 11px;font-size:.79rem;border-bottom:1px solid rgba(33,41,61,.45);vertical-align:middle;white-space:nowrap;}
tr:last-child td{border-bottom:none;}
tr:hover td{background:rgba(255,255,255,.016);}
.mono{font-family:'JetBrains Mono',monospace;font-size:.74rem;}

/* PADRONIZAÇÃO — tabelas do sistema */
.tbl-wrap{overflow-x:auto;}
.tbl{width:100%;border-collapse:separate;border-spacing:0;border:1px solid var(--b1);border-radius:10px;overflow:hidden;}
.tbl thead th{padding:10px 14px;text-align:left;font-size:.6rem;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--t3);background:var(--s2);border-bottom:1px solid var(--b1);white-space:nowrap;}
.tbl tbody tr{transition:background .12s;}
.tbl tbody tr:hover{background:rgba(255,255,255,.02);}
.tbl tbody tr.fin-pago{opacity:.5;transition:opacity .2s;}
.tbl tbody tr.fin-pago:hover{opacity:1;}
.tbl tbody td{padding:10px 14px;border-bottom:1px solid var(--b1);font-size:.78rem;vertical-align:middle;}
.tbl tbody td:not(:first-child){text-align:right;font-family:'JetBrains Mono',monospace;font-size:.76rem;}
.tbl tbody tr:last-child td{border-bottom:none;}

.ct{display:inline-flex;align-items:center;gap:4px;padding:3px 9px;border-radius:17px;font-size:.65rem;font-weight:700;text-transform:uppercase;letter-spacing:.4px;}
.ct-imp{background:rgba(240,180,41,.13);color:var(--gold);border:1px solid rgba(240,180,41,.22);}
.ct-ch{background:rgba(59,130,246,.13);color:#60a5fa;border:1px solid rgba(59,130,246,.22);}
.ct-3bt{background:rgba(168,85,247,.13);color:#c084fc;border:1px solid rgba(168,85,247,.22);}
.ct-con{background:rgba(16,185,129,.13);color:var(--green);border:1px solid rgba(16,185,129,.22);}
.ct-tgp{background:rgba(249,115,22,.13);color:#fb923c;border:1px solid rgba(249,115,22,.22);}
.ct-unk{background:rgba(239,68,68,.1);color:var(--red);border:1px solid rgba(239,68,68,.25);cursor:pointer;}
.ct-unk:hover{background:rgba(239,68,68,.2);}

.fb{display:inline-block;padding:2px 8px;border-radius:9px;font-size:.66rem;font-weight:600;}
.fb-j{background:rgba(14,165,233,.1);color:#38bdf8;}
.fb-a{background:rgba(240,180,41,.1);color:var(--gold);}
.fb-s{background:rgba(168,85,247,.1);color:#c084fc;}

.rb-wrap{display:flex;align-items:center;gap:4px;}
.rb-inp{background:var(--s3);border:1px solid var(--b2);color:var(--gold);width:58px;padding:4px 7px;border-radius:6px;font-family:'JetBrains Mono',monospace;font-size:.76rem;text-align:center;}
.rb-inp:focus{outline:none;border-color:var(--gold);}
.rb-pct{color:var(--t3);font-size:.72rem;}

.vp{color:var(--green);font-family:'JetBrains Mono',monospace;font-size:.7rem;}
.vn{color:var(--red);font-family:'JetBrains Mono',monospace;font-size:.7rem;}
.vz{color:var(--t3);font-family:'JetBrains Mono',monospace;font-size:.7rem;}
.vm{color:var(--t2);font-family:'JetBrains Mono',monospace;font-size:.7rem;}

.pagination{display:flex;align-items:center;justify-content:space-between;padding:10px 0 0;}
.pg-info{font-size:.76rem;color:var(--t3);}
.pg-btns{display:flex;gap:5px;}
.pg-btn{background:var(--s2);border:1px solid var(--b1);color:var(--t2);padding:5px 10px;border-radius:6px;cursor:pointer;font-size:.76rem;font-family:'Outfit',sans-serif;transition:all .15s;}
.pg-btn:hover{border-color:var(--gold);color:var(--gold);}
.pg-btn.act{background:var(--gold-d);border-color:var(--gold);color:var(--gold);}
.pg-btn:disabled{opacity:.3;pointer-events:none;}

.empty-tbl{text-align:center;padding:45px 20px;color:var(--t3);}
.empty-tbl .ei{font-size:2.3rem;margin-bottom:10px;}
.empty-tbl p{font-size:.8rem;line-height:1.6;}

/* ═══ FINANCEIRO SaaS DASHBOARD ═══ */
.fin-filter-btn{padding:5px 13px;border-radius:7px;font-size:.72rem;font-weight:600;cursor:pointer;border:1px solid var(--b2);background:var(--s2);color:var(--t3);transition:all .15s;}
.fin-filter-btn.active{background:rgba(240,180,41,.1);border-color:rgba(240,180,41,.3);color:var(--gold);}
.fin-filter-btn[data-filter="aberto"].active{background:rgba(239,68,68,.1);border-color:rgba(239,68,68,.25);color:#ef4444;}
.fin-filter-btn[data-filter="parcial"].active{background:rgba(251,146,60,.1);border-color:rgba(251,146,60,.25);color:#fb923c;}
.fin-filter-btn[data-filter="pago"].active{background:rgba(16,185,129,.1);border-color:rgba(16,185,129,.25);color:#10b981;}

/* KPI strip */
/* Fin Sub-tabs */
.fin-stabs{display:flex;gap:4px;border-bottom:1px solid var(--b1);padding-bottom:0;}
.fin-stab{background:none;border:none;border-bottom:2px solid transparent;color:var(--t3);padding:8px 16px;font-size:.78rem;font-weight:700;cursor:pointer;transition:all .15s;}
.fin-stab:hover{color:var(--t1);}
.fin-stab.active{color:var(--gold);border-bottom-color:var(--gold);}
.conc-tabs{display:flex;gap:4px;background:var(--s2);border-radius:8px;padding:3px;}
.conc-tab{background:none;border:none;color:var(--t3);padding:7px 14px;font-size:.72rem;font-weight:700;cursor:pointer;border-radius:6px;transition:all .15s;}
.conc-tab:hover{color:var(--t1);background:rgba(255,255,255,.04);}
.conc-tab.active{color:var(--t1);background:var(--s1);box-shadow:0 1px 3px rgba(0,0,0,.2);}
.badge-linked{background:rgba(16,185,129,.1);border:1px solid rgba(16,185,129,.2);color:#10b981;padding:2px 8px;border-radius:5px;font-size:.6rem;font-weight:700;}
.badge-unlinked{background:rgba(251,146,60,.1);border:1px solid rgba(251,146,60,.2);color:#fb923c;padding:2px 8px;border-radius:5px;font-size:.6rem;font-weight:700;}
.badge-applied{background:rgba(129,140,248,.1);border:1px solid rgba(129,140,248,.2);color:#818cf8;padding:2px 8px;border-radius:5px;font-size:.6rem;font-weight:700;}
.conc-summary{display:flex;gap:16px;flex-wrap:wrap;padding:12px 0;margin-bottom:12px;border-bottom:1px solid var(--b1);}
.conc-summary .cs-box{text-align:center;}
.conc-summary .cs-lbl{font-size:.56rem;font-weight:700;text-transform:uppercase;letter-spacing:.8px;color:var(--t3);margin-bottom:2px;}
.conc-summary .cs-val{font-weight:800;font-size:.82rem;}
.conc-entity-sel{background:var(--s2);border:1px solid var(--b1);color:var(--t1);padding:4px 8px;border-radius:6px;font-size:.72rem;max-width:180px;cursor:pointer;}
.conc-btn{padding:5px 12px;border-radius:6px;font-size:.7rem;font-weight:700;cursor:pointer;border:1px solid;transition:all .15s;}
.conc-btn-link{background:rgba(16,185,129,.1);border-color:rgba(16,185,129,.25);color:#10b981;}
.conc-btn-link:hover{background:rgba(16,185,129,.2);}
.conc-btn-ign{background:none;border-color:var(--b1);color:var(--t3);font-size:.68rem;padding:3px 8px;}
.bank-card{background:var(--s2);border:1px solid var(--b1);border-radius:10px;padding:14px 18px;display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;}
.bank-card .bank-name{font-weight:700;color:var(--t1);font-size:.82rem;}
.bank-card .bank-info{font-size:.68rem;color:var(--t3);}
.bank-card .bank-default{background:rgba(240,180,41,.1);border:1px solid rgba(240,180,41,.25);color:var(--gold);padding:2px 8px;border-radius:5px;font-size:.58rem;font-weight:700;margin-left:8px;}
.bank-card .bank-actions{display:flex;gap:6px;}
.bank-card .bank-actions button{background:none;border:1px solid var(--b1);color:var(--t3);padding:4px 8px;border-radius:5px;font-size:.68rem;cursor:pointer;}
.bank-card .bank-actions button:hover{color:var(--t1);border-color:var(--t3);}
.fkpi-strip{display:grid;grid-template-columns:repeat(5,1fr);gap:10px;margin-bottom:18px;}
.fkpi{background:var(--s1);border:1px solid var(--b1);border-radius:10px;padding:14px 16px;position:relative;overflow:hidden;transition:border-color .2s;}
.fkpi:hover{border-color:var(--b2);}
.fkpi-lbl{font-size:.58rem;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--t3);margin-bottom:7px;display:flex;align-items:center;gap:5px;}
.fkpi-val{font-family:'JetBrains Mono',monospace;font-size:1.05rem;font-weight:800;line-height:1;}
.fkpi-sub{font-size:.6rem;color:var(--t3);margin-top:4px;}
.fkpi::after{content:'';position:absolute;bottom:0;left:0;right:0;height:2px;}
.fkpi.green::after{background:linear-gradient(90deg,#10b981,rgba(16,185,129,.2));}
.fkpi.red::after{background:linear-gradient(90deg,#ef4444,rgba(239,68,68,.2));}
.fkpi.blue::after{background:linear-gradient(90deg,#3b82f6,rgba(59,130,246,.2));}
.fkpi.purple::after{background:linear-gradient(90deg,#8b5cf6,rgba(139,92,246,.2));}
.fkpi.gold::after{background:linear-gradient(90deg,var(--gold),rgba(240,180,41,.2));}

/* Controls bar */
.fin-controls{display:flex;align-items:center;gap:10px;margin-bottom:14px;flex-wrap:wrap;}
.fin-search{background:var(--s2);border:1px solid var(--b2);color:var(--t1);padding:7px 12px 7px 32px;border-radius:8px;font-size:.78rem;width:220px;outline:none;transition:border-color .15s;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2'%3E%3Ccircle cx='11' cy='11' r='8'/%3E%3Cpath d='m21 21-4.35-4.35'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:10px center;}
.fin-search:focus{border-color:rgba(240,180,41,.4);}
.fin-search::placeholder{color:var(--t3);}
.fin-toggle{display:flex;align-items:center;gap:6px;font-size:.72rem;color:var(--t3);cursor:pointer;padding:5px 10px;border-radius:7px;border:1px solid var(--b2);background:var(--s2);transition:all .15s;user-select:none;}
.fin-toggle.on{background:rgba(96,165,250,.1);border-color:rgba(96,165,250,.3);color:#60a5fa;}
.fin-toggle .fin-sw{width:28px;height:15px;border-radius:20px;background:var(--b2);position:relative;transition:background .2s;}
.fin-toggle .fin-sw::after{content:'';position:absolute;top:2px;left:2px;width:11px;height:11px;border-radius:50%;background:var(--t3);transition:all .2s;}
.fin-toggle.on .fin-sw{background:rgba(96,165,250,.5);}
.fin-toggle.on .fin-sw::after{left:15px;background:#60a5fa;}

/* Table — see .tbl above */

/* Entity cell */
.fin-ent{display:flex;align-items:center;gap:9px;}
.fin-ent-ico{width:30px;height:30px;border-radius:7px;display:flex;align-items:center;justify-content:center;font-size:.82rem;flex-shrink:0;}
.fin-ent-ico.ag{background:rgba(192,132,252,.1);border:1px solid rgba(192,132,252,.18);}
.fin-ent-ico.pl{background:rgba(96,165,250,.1);border:1px solid rgba(96,165,250,.18);}
.fin-ent-name{font-weight:700;font-size:.8rem;color:var(--t1);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:180px;}
.fin-ent-sub{font-size:.62rem;color:var(--t3);margin-top:1px;}

/* Status pill */
.fin-pill{display:inline-flex;align-items:center;gap:4px;padding:3px 9px;border-radius:20px;font-size:.64rem;font-weight:700;white-space:nowrap;}
.fin-pill.aberto{background:rgba(239,68,68,.09);border:1px solid rgba(239,68,68,.15);color:#ef4444;}
.fin-pill.parcial{background:rgba(251,146,60,.09);border:1px solid rgba(251,146,60,.18);color:#fb923c;}
.fin-pill.pago{background:rgba(16,185,129,.09);border:1px solid rgba(16,185,129,.18);color:#10b981;}
.fin-pill.neutro{background:var(--s2);border:1px solid var(--b2);color:var(--t3);}

/* Action buttons */
.fin-act{display:flex;gap:5px;justify-content:center;}
.fin-act button{padding:4px 9px;border-radius:6px;font-size:.65rem;font-weight:700;cursor:pointer;border:1px solid;transition:all .12s;white-space:nowrap;}
.fin-act .fa-recv{background:rgba(16,185,129,.08);border-color:rgba(16,185,129,.2);color:#10b981;}
.fin-act .fa-recv:hover{background:rgba(16,185,129,.18);}
.fin-act .fa-pay{background:rgba(96,165,250,.08);border-color:rgba(96,165,250,.2);color:#60a5fa;}
.fin-act .fa-pay:hover{background:rgba(96,165,250,.18);}
.fin-act .fa-hist{background:var(--s2);border-color:var(--b2);color:var(--t3);}
.fin-act .fa-hist:hover{background:rgba(255,255,255,.06);color:var(--t2);}

/* History Drawer */
.fin-drawer-overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:9998;opacity:0;pointer-events:none;transition:opacity .25s;}
.fin-drawer-overlay.open{opacity:1;pointer-events:auto;}
.fin-drawer{position:fixed;top:0;right:-480px;width:460px;max-width:92vw;height:100vh;background:var(--s1);border-left:1px solid var(--b1);z-index:9999;transition:right .3s cubic-bezier(.4,0,.2,1);display:flex;flex-direction:column;box-shadow:-8px 0 32px rgba(0,0,0,.4);}
.fin-drawer.open{right:0;}
.fin-drawer-head{padding:18px 20px;border-bottom:1px solid var(--b1);display:flex;align-items:center;justify-content:space-between;flex-shrink:0;}
.fin-drawer-close{background:var(--s2);border:1px solid var(--b2);color:var(--t2);width:30px;height:30px;border-radius:7px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:.85rem;transition:all .12s;}
.fin-drawer-close:hover{background:rgba(239,68,68,.1);border-color:rgba(239,68,68,.2);color:#ef4444;}
.fin-drawer-body{flex:1;overflow-y:auto;padding:16px 20px;}
.fin-drawer-foot{padding:14px 20px;border-top:1px solid var(--b1);flex-shrink:0;}

/* Drawer items */
.fd-summary{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-bottom:18px;}
.fd-box{background:var(--s2);border-radius:8px;padding:10px 12px;text-align:center;}
.fd-box-lbl{font-size:.56rem;font-weight:700;text-transform:uppercase;letter-spacing:.8px;color:var(--t3);margin-bottom:4px;}
.fd-box-val{font-family:'JetBrains Mono',monospace;font-weight:800;font-size:.88rem;}
.fd-item{display:flex;align-items:center;gap:10px;padding:10px 12px;background:var(--s2);border-radius:8px;margin-bottom:6px;transition:background .1s;}
.fd-item:hover{background:rgba(255,255,255,.04);}
.fd-dir{width:26px;height:26px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:.72rem;flex-shrink:0;}
.fd-dir.in{background:rgba(16,185,129,.1);border:1px solid rgba(16,185,129,.18);color:#10b981;}
.fd-dir.out{background:rgba(96,165,250,.1);border:1px solid rgba(96,165,250,.18);color:#60a5fa;}
.fd-info{flex:1;min-width:0;}
.fd-metodo{font-size:.72rem;font-weight:700;color:var(--t1);}
.fd-meta{font-size:.62rem;color:var(--t3);margin-top:1px;}
.fd-val{font-family:'JetBrains Mono',monospace;font-weight:800;font-size:.82rem;white-space:nowrap;}
.fd-actions{display:flex;gap:4px;flex-shrink:0;}
.fd-actions button{background:none;border:none;color:var(--t3);cursor:pointer;padding:3px;border-radius:4px;font-size:.72rem;transition:all .1s;}
.fd-actions button:hover{color:#ef4444;background:rgba(239,68,68,.08);}
.fd-empty{text-align:center;padding:32px 16px;color:var(--t3);font-size:.8rem;}

/* Metodo btn (kept) */
.fin-metodo-btn{padding:7px 14px;border-radius:8px;font-size:.75rem;font-weight:700;cursor:pointer;border:1px solid var(--b2);background:var(--s2);color:var(--t2);transition:all .15s;}
.fin-metodo-btn.active{background:rgba(240,180,41,.12);border-color:var(--gold);color:var(--gold);}
.saldo-prev-badge{display:inline-flex;align-items:center;gap:5px;background:rgba(239,68,68,.08);border:1px solid rgba(239,68,68,.15);border-radius:6px;padding:3px 8px;font-size:.68rem;color:#ef4444;font-weight:600;}

/* auto-save indicator */
.autosave-dot{display:inline-block;width:6px;height:6px;border-radius:50%;background:#10b981;margin-right:4px;animation:pulse-green 2s infinite;}
@keyframes pulse-green{0%,100%{opacity:1}50%{opacity:.3}}

/* ── OFX ── */
.ofx-filter{padding:4px 12px;border-radius:7px;font-size:.72rem;font-weight:600;cursor:pointer;border:1px solid var(--b2);background:var(--s2);color:var(--t3);transition:all .15s;}
.ofx-filter.active{background:rgba(59,130,246,.12);border-color:rgba(59,130,246,.3);color:#60a5fa;}
.ofx-bank-tab{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:20px;font-size:.7rem;font-weight:700;border:1px solid rgba(59,130,246,.25);background:rgba(59,130,246,.07);color:#60a5fa;}
.ofx-tab-x{background:none;border:none;color:rgba(96,165,250,.5);cursor:pointer;padding:0;font-size:.75rem;line-height:1;margin-left:2px;transition:color .1s;}
.ofx-tab-x:hover{color:#ef4444;}
.ofx-row td{padding:7px 10px;border-bottom:1px solid var(--b1);font-size:.77rem;vertical-align:middle;}
.ofx-row:hover td{background:rgba(255,255,255,.02);}
.ofx-row.aplicado td{opacity:.4;}
.ofx-row.ignorado td{opacity:.28;}
.ofx-entity-select{background:var(--s2);border:1px solid var(--b2);color:var(--t1);padding:5px 8px;border-radius:7px;font-size:.72rem;width:100%;cursor:pointer;outline:none;}
.ofx-entity-select:focus{border-color:rgba(59,130,246,.5);}
.ofx-badge-vinc{background:rgba(16,185,129,.1);border:1px solid rgba(16,185,129,.2);color:#10b981;padding:2px 8px;border-radius:5px;font-size:.65rem;font-weight:700;}
.ofx-badge-aplic{background:rgba(129,140,248,.1);border:1px solid rgba(129,140,248,.2);color:#818cf8;padding:2px 8px;border-radius:5px;font-size:.65rem;font-weight:700;}
.ofx-badge-pend{background:rgba(251,146,60,.08);border:1px solid rgba(251,146,60,.2);color:#fb923c;padding:2px 8px;border-radius:5px;font-size:.65rem;font-weight:700;}
.ofx-badge-ign{background:var(--s2);border:1px solid var(--b2);color:var(--t3);padding:2px 8px;border-radius:5px;font-size:.65rem;font-weight:700;}
.ofx-btn-ign{background:none;border:none;color:var(--t3);cursor:pointer;font-size:.75rem;padding:2px 6px;border-radius:5px;transition:all .1s;}
.ofx-btn-ign:hover{color:#ef4444;background:rgba(239,68,68,.08);}

/* ── CP DROPDOWN CUSTOMIZADO ── */
.cp-dd{position:relative;width:100%;}
.cp-dd-trigger{display:flex;align-items:center;justify-content:space-between;background:var(--s2);border:1px solid var(--b2);color:var(--t1);padding:5px 8px;border-radius:7px;font-size:.72rem;cursor:pointer;gap:4px;min-width:0;}
.cp-dd-trigger:hover{border-color:rgba(16,185,129,.4);}
.cp-dd-trigger.active{border-color:rgba(16,185,129,.5);border-radius:7px 7px 0 0;}
.cp-dd-trigger span{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex:1;}
.cp-dd-panel{display:none;position:absolute;top:100%;left:0;right:0;background:var(--s1);border:1px solid rgba(16,185,129,.35);border-top:none;border-radius:0 0 8px 8px;z-index:999;box-shadow:0 8px 24px rgba(0,0,0,.4);}
.cp-dd-panel.open{display:block;}
.cp-dd-input{width:100%;box-sizing:border-box;background:var(--s2);border:none;border-bottom:1px solid var(--b1);color:var(--t1);padding:7px 10px;font-size:.72rem;outline:none;}
.cp-dd-input::placeholder{color:var(--t3);}
.cp-dd-list{max-height:180px;overflow-y:auto;}
.cp-dd-group{padding:5px 10px 2px;font-size:.6rem;font-weight:700;text-transform:uppercase;letter-spacing:.8px;color:var(--t3);background:var(--s2);}
.cp-dd-item{padding:6px 12px;font-size:.73rem;color:var(--t2);cursor:pointer;transition:background .1s;}
.cp-dd-item:hover,.cp-dd-item.focused{background:rgba(16,185,129,.1);color:#10b981;}
.cp-dd-item mark{background:rgba(16,185,129,.25);color:#10b981;border-radius:2px;padding:0 2px;}
.cp-dd-empty{padding:12px;text-align:center;font-size:.72rem;color:var(--t3);}


.cp-filter{padding:4px 12px;border-radius:7px;font-size:.72rem;font-weight:600;cursor:pointer;border:1px solid var(--b2);background:var(--s2);color:var(--t3);transition:all .15s;}
.cp-filter.active{background:rgba(16,185,129,.12);border-color:rgba(16,185,129,.3);color:#34d399;}
.cp-row td{padding:7px 10px;border-bottom:1px solid var(--b1);font-size:.77rem;vertical-align:middle;}
.cp-row:hover td{background:rgba(255,255,255,.02);}
.cp-row.aplicado td{opacity:.4;}
.cp-row.ignorado td{opacity:.28;}
.cp-select{background:var(--s2);border:1px solid var(--b2);color:var(--t1);padding:5px 8px;border-radius:7px;font-size:.72rem;width:100%;cursor:pointer;outline:none;}
.cp-select:focus{border-color:rgba(16,185,129,.5);}
.cp-badge-vinc{background:rgba(16,185,129,.1);border:1px solid rgba(16,185,129,.2);color:#10b981;padding:2px 8px;border-radius:5px;font-size:.65rem;font-weight:700;}
.cp-badge-aplic{background:rgba(129,140,248,.1);border:1px solid rgba(129,140,248,.2);color:#818cf8;padding:2px 8px;border-radius:5px;font-size:.65rem;font-weight:700;}
.cp-badge-pend{background:rgba(251,146,60,.08);border:1px solid rgba(251,146,60,.2);color:#fb923c;padding:2px 8px;border-radius:5px;font-size:.65rem;font-weight:700;}
.cp-badge-ign{background:var(--s2);border:1px solid var(--b2);color:var(--t3);padding:2px 8px;border-radius:5px;font-size:.65rem;font-weight:700;}
.cp-btn-ign{background:none;border:none;color:var(--t3);cursor:pointer;font-size:.75rem;padding:2px 6px;border-radius:5px;transition:all .1s;}
.cp-btn-ign:hover{color:#ef4444;background:rgba(239,68,68,.08);}

/* ── FECHAMENTO DE AGENTES ── */
/* ── COMPROVANTES (card row layout) ── */
.comp-card{background:var(--s1);border:1px solid var(--b1);border-radius:8px;margin-bottom:5px;overflow:hidden;transition:border-color .2s;}
.comp-card:hover{border-color:var(--b2);}
.comp-card-dim{opacity:.4;}
.comp-row{display:flex;align-items:center;padding:8px 12px;gap:10px;}
.comp-left{display:flex;align-items:center;gap:7px;flex-shrink:0;min-width:160px;}
.comp-avatar{width:26px;height:26px;border-radius:6px;background:var(--gold-d);border:1px solid rgba(240,180,41,.25);display:flex;align-items:center;justify-content:center;font-size:.72rem;flex-shrink:0;}
.comp-name-line{display:flex;align-items:center;gap:5px;}
.comp-name{font-weight:700;font-size:.74rem;color:var(--t1);white-space:nowrap;}
.comp-cnt{font-size:.52rem;color:var(--t3);}
.comp-meta{margin-top:2px;}
.comp-badge{padding:1px 5px;border-radius:4px;font-size:.46rem;font-weight:700;border:1px solid;}
.comp-edit-btn{background:none;border:1px solid var(--b1);color:var(--t3);padding:0 3px;border-radius:3px;font-size:.42rem;cursor:pointer;line-height:1.3;margin-left:3px;}
.comp-tog{display:inline-flex;border:1px solid var(--b2);border-radius:4px;overflow:hidden;}
.comp-tog-btn{padding:1px 5px;font-size:.46rem;font-weight:700;cursor:pointer;border:none;background:transparent;color:var(--t3);transition:all .12s;white-space:nowrap;}
.comp-tog-btn.sel{background:rgba(255,255,255,.06);color:var(--t1);}
.comp-ok-btn{background:rgba(16,185,129,.1);border:1px solid rgba(16,185,129,.25);color:#10b981;padding:1px 6px;border-radius:4px;font-size:.46rem;font-weight:700;cursor:pointer;margin-left:3px;}
.comp-vals{display:flex;align-items:center;gap:16px;flex:1;justify-content:flex-end;}
.comp-v{text-align:right;flex-shrink:0;}
.comp-v-lbl{font-size:.38rem;text-transform:uppercase;letter-spacing:.5px;color:var(--t3);font-weight:600;line-height:1;margin-bottom:1px;}
.comp-v-num{font-family:'JetBrains Mono',monospace;font-size:.7rem;font-weight:700;line-height:1.2;}
.comp-v-final{min-width:75px;}
.comp-v-res{font-family:'JetBrains Mono',monospace;font-size:.88rem;font-weight:900;line-height:1.2;}
.comp-actions{display:flex;align-items:center;gap:5px;flex-shrink:0;margin-left:6px;}
.comp-btn-gen{background:linear-gradient(135deg,var(--gold),#c47d00);color:#000;border:none;padding:5px 10px;border-radius:5px;font-size:.55rem;font-weight:700;cursor:pointer;white-space:nowrap;transition:opacity .15s;min-width:120px;text-align:center;}
.comp-btn-gen:hover{opacity:.85;}
.comp-btn-det{background:none;border:none;color:var(--t3);padding:3px 5px;font-size:.5rem;cursor:pointer;white-space:nowrap;transition:color .15s;}
.comp-btn-det:hover{color:var(--gold);}
.comp-expand{border-top:1px solid var(--b1);padding:12px 14px;background:rgba(255,255,255,.01);animation:cSlide .12s ease-out;}
@keyframes cSlide{from{opacity:0;transform:translateY(-3px);}to{opacity:1;transform:translateY(0);}}
.comp-fin{background:var(--s2);border:1px solid var(--b1);border-radius:8px;padding:8px 12px;max-width:360px;}
.comp-fin-r{display:flex;justify-content:space-between;align-items:center;font-size:.72rem;padding:2px 0;}
.comp-pl{width:100%;border-collapse:collapse;}
.comp-pl th{padding:3px 7px;font-size:.44rem;font-weight:700;text-transform:uppercase;letter-spacing:.3px;color:var(--t3);border-bottom:1px solid var(--b1);background:var(--s2);}
.comp-pl td{padding:3px 7px;font-size:.68rem;font-family:'JetBrains Mono',monospace;border-bottom:1px solid rgba(33,41,61,.1);}
.comp-pl tfoot td{font-weight:800;border-top:2px solid var(--b1);background:var(--s2);padding:4px 7px;}

/* PDF PREVIEW MODAL */
#pdf-modal .modal{width:680px;max-width:96vw;padding:0;overflow:hidden;}
.pdf-preview{background:#1a1f2e;padding:0;}
.pdf-doc{background:#fff;color:#111;font-family:'Outfit',sans-serif;padding:32px 36px;min-height:400px;}
.pdf-header-doc{display:flex;align-items:center;justify-content:space-between;margin-bottom:24px;padding-bottom:16px;border-bottom:2px solid #f0b429;}
.pdf-logo{font-size:1.2rem;font-weight:800;color:#111;}
.pdf-logo span{color:#f0b429;}
.pdf-period{font-size:.78rem;color:#666;text-align:right;}
.pdf-agent-title{font-size:1.1rem;font-weight:800;margin-bottom:4px;color:#111;}
.pdf-agent-sub{font-size:.78rem;color:#888;margin-bottom:20px;}
.pdf-table{width:100%;border-collapse:collapse;margin-bottom:20px;font-size:.78rem;}
.pdf-table th{background:#f8f4e8;padding:7px 10px;text-align:left;font-weight:700;color:#555;font-size:.68rem;text-transform:uppercase;letter-spacing:.5px;}
.pdf-table td{padding:7px 10px;border-bottom:1px solid #f0f0f0;}
.pdf-table tr:last-child td{border-bottom:none;}
.pdf-totals{background:#f8f4e8;border-radius:8px;padding:14px 16px;margin-bottom:16px;}
.pdf-total-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;font-size:.82rem;}
.pdf-total-row:last-child{margin-bottom:0;font-weight:800;font-size:.9rem;color:#111;border-top:1px solid #ddd;padding-top:8px;margin-top:4px;}
.pdf-total-label{color:#666;}
.pdf-total-val{font-family:'Courier New',monospace;font-weight:700;}
.pos-val{color:#16a34a;}
.neg-val{color:#dc2626;}
.pdf-footer-doc{margin-top:16px;padding-top:12px;border-top:1px solid #eee;font-size:.68rem;color:#aaa;text-align:center;}

.rs-row{display:flex;align-items:center;justify-content:space-between;padding:10px 14px;border-radius:9px;margin-bottom:6px;background:var(--s2);border:1px solid var(--b1);gap:12px;}
.rs-row.rs-row-ref{background:transparent;border-color:var(--b1);opacity:.7;}
.rs-row.rs-manual{background:var(--s2);border:1px solid var(--b2);}
.rs-label{font-size:.82rem;font-weight:600;color:var(--t1);display:flex;flex-direction:column;gap:3px;}
.rs-formula{font-size:.68rem;color:var(--t3);font-weight:400;}
.rs-val{font-family:'JetBrains Mono',monospace;font-size:.9rem;font-weight:700;min-width:130px;text-align:right;white-space:nowrap;}
.rs-val.gr{color:var(--green);}
.rs-val.rd{color:var(--red);}
.rs-input-wrap{display:flex;align-items:center;gap:7px;}
.rs-currency{font-size:.78rem;font-weight:700;color:var(--t3);}
.rs-inp{background:var(--s3);border:1px solid var(--b2);color:var(--gold);width:130px;padding:7px 10px;border-radius:7px;font-family:'JetBrains Mono',monospace;font-size:.84rem;text-align:right;transition:border-color .2s;}
.rs-inp:focus{outline:none;border-color:var(--gold);}
.rs-final-box{background:linear-gradient(135deg,rgba(240,180,41,.08),rgba(240,180,41,.03));border:2px solid rgba(240,180,41,.25);border-radius:14px;padding:20px 22px;}
.rs-breakdown{display:flex;flex-wrap:wrap;gap:7px;margin-top:14px;padding-top:14px;border-top:1px solid rgba(240,180,41,.15);}
.rs-bd-item{background:rgba(240,180,41,.07);border:1px solid rgba(240,180,41,.14);border-radius:8px;padding:6px 12px;font-size:.73rem;display:flex;align-items:center;gap:6px;}
.rs-bd-lbl{color:rgba(240,180,41,.6);font-weight:600;white-space:nowrap;}
.rs-bd-val{font-family:'JetBrains Mono',monospace;font-weight:700;}
.rs-bd-val.pos{color:var(--green);}
.rs-bd-val.neg{color:var(--red);}
.rs-bd-val.neu{color:var(--t2);}

/* ── CONFIGURAÇÕES / LOGOS ── */
.cfg-card{background:var(--s1);border:1px solid var(--b1);border-radius:12px;padding:16px 18px;display:flex;align-items:center;gap:16px;}
.cfg-logo-preview{width:56px;height:56px;border-radius:12px;background:var(--s2);border:2px solid var(--b2);display:flex;align-items:center;justify-content:center;font-size:1.6rem;flex-shrink:0;overflow:hidden;}
.cfg-logo-preview img{width:100%;height:100%;object-fit:cover;border-radius:10px;}
.cfg-info{flex:1;}
.cfg-name{font-size:.92rem;font-weight:700;color:var(--t1);}
.cfg-sub{font-size:.73rem;color:var(--t3);margin-top:3px;}
.cfg-actions{display:flex;gap:8px;align-items:center;}
.cfg-upload-btn{background:var(--s2);border:1px solid var(--b2);color:var(--t1);padding:7px 14px;border-radius:8px;font-size:.78rem;font-weight:600;cursor:pointer;transition:all .15s;}
.cfg-upload-btn:hover{border-color:var(--gold);color:var(--gold);}
.cfg-remove-btn{background:transparent;border:1px solid rgba(239,68,68,.3);color:rgba(239,68,68,.7);padding:7px 10px;border-radius:8px;font-size:.75rem;cursor:pointer;transition:all .15s;}
.cfg-remove-btn:hover{border-color:var(--red);color:var(--red);}
.ni-logo{width:18px;height:18px;border-radius:4px;object-fit:cover;vertical-align:middle;}
.dc-icon img{width:100%;height:100%;object-fit:cover;border-radius:9px;}
.coc-logo{width:28px;height:28px;border-radius:7px;object-fit:cover;vertical-align:middle;margin-right:4px;}

/* ── EXPANDABLE AGENT ROWS ── */
tr.agent-row{cursor:pointer;background:rgba(240,180,41,.05);}
tr.agent-row:hover td{background:rgba(240,180,41,.09)!important;}
tr.agent-row td{border-bottom:1px solid rgba(240,180,41,.15);font-weight:600;}
.agent-toggle{display:inline-flex;align-items:center;justify-content:center;width:20px;height:20px;border-radius:5px;background:var(--s3);border:1px solid var(--b2);font-size:.7rem;margin-right:6px;transition:transform .2s;flex-shrink:0;color:var(--gold);}
tr.agent-row.open .agent-toggle{transform:rotate(90deg);}
tr.player-sub{background:rgba(255,255,255,.012);}
tr.player-sub td{font-size:.76rem;border-bottom:1px solid rgba(33,41,61,.3);}
tr.player-sub td:first-child{padding-left:28px;}
tr.player-sub:last-of-type td{border-bottom:2px solid rgba(240,180,41,.12);}
tr.player-sub.hidden{display:none;}
.agent-name-cell{display:flex;align-items:center;}
.agent-count-badge{margin-left:8px;background:var(--s3);border-radius:8px;padding:1px 7px;font-size:.67rem;font-family:'JetBrains Mono',monospace;color:var(--t3);font-weight:400;}
/* Totals footer row */
tr.agent-total-row td{font-family:'JetBrains Mono',monospace;font-size:.74rem;font-weight:700;background:rgba(240,180,41,.04);border-top:1px solid rgba(240,180,41,.15);border-bottom:2px solid rgba(240,180,41,.2);}
/* Grand total row */
tr.grand-total-row td{font-family:'JetBrains Mono',monospace;font-size:.8rem;font-weight:800;background:rgba(240,180,41,.1);border-top:2px solid rgba(240,180,41,.3);color:var(--gold);}

/* ── REDESIGNED TABLE V2 ── */
.v2-kpis{display:grid;grid-template-columns:repeat(5,1fr);gap:10px;margin-bottom:18px;}
.v2-kpi{background:var(--s2);border:1px solid var(--b1);border-radius:10px;padding:12px 14px;position:relative;overflow:hidden;}
.v2-kpi::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;}
.v2-kpi.k-rake::before{background:var(--green);}
.v2-kpi.k-rbp::before{background:#fb923c;}
.v2-kpi.k-rba::before{background:#c084fc;}
.v2-kpi.k-res::before{background:var(--gold);}
.v2-kpi.k-aberto::before{background:var(--red);}
.v2-kpi-lbl{font-size:.58rem;font-weight:700;text-transform:uppercase;letter-spacing:.9px;color:var(--t3);margin-bottom:5px;}
.v2-kpi-val{font-family:'JetBrains Mono',monospace;font-size:1rem;font-weight:700;}

/* Agent row V2 */
tr.ag2{cursor:pointer;background:rgba(240,180,41,.04);}
tr.ag2:hover td{background:rgba(240,180,41,.08)!important;}
tr.ag2 td{border-bottom:1px solid rgba(240,180,41,.12);padding:10px 11px;}
.ag2-name{display:flex;align-items:center;gap:7px;}
.ag2-toggle{width:18px;height:18px;border-radius:4px;background:var(--s3);border:1px solid var(--b2);display:inline-flex;align-items:center;justify-content:center;font-size:.6rem;color:var(--gold);transition:transform .2s;flex-shrink:0;}
tr.ag2.open .ag2-toggle{transform:rotate(90deg);}
.ag2-label{font-weight:700;font-size:.82rem;color:var(--t1);}
.ag2-count{background:var(--s3);border-radius:7px;padding:1px 7px;font-size:.62rem;font-family:'JetBrains Mono',monospace;color:var(--t3);}
.ag2-resultado{font-family:'JetBrains Mono',monospace;font-weight:800;font-size:.82rem;padding:4px 10px;border-radius:6px;}
.ag2-resultado.pos{background:rgba(16,185,129,.1);color:#10b981;}
.ag2-resultado.neg{background:rgba(239,68,68,.08);color:#ef4444;}
.ag2-resultado.zero{background:rgba(74,85,104,.1);color:var(--t3);}

/* Player row V2 */
tr.pl2{background:transparent;}
tr.pl2 td{font-size:.77rem;padding:7px 11px;border-bottom:1px solid rgba(33,41,61,.3);}
tr.pl2.hidden{display:none;}
tr.pl2 td:first-child{padding-left:32px;}
.pl2-nick{font-weight:600;color:var(--t1);font-size:.8rem;}
.pl2-id{font-family:'JetBrains Mono',monospace;font-size:.6rem;color:var(--t3);margin-top:1px;}
.pl2-rb{display:flex;align-items:center;gap:4px;font-family:'JetBrains Mono',monospace;font-size:.7rem;}
.pl2-rb-pct{color:var(--t3);font-size:.65rem;}
.pl2-rb-val{color:#a3e635;font-weight:700;}
.pl2-resultado{font-family:'JetBrains Mono',monospace;font-weight:800;font-size:.8rem;padding:3px 8px;border-radius:5px;display:inline-block;}
.pl2-resultado.pos{background:rgba(16,185,129,.08);color:#10b981;}
.pl2-resultado.neg{background:rgba(239,68,68,.06);color:#ef4444;}
.pl2-resultado.zero{color:var(--t3);}
.pl2-saldo-badge{display:inline-flex;align-items:center;gap:4px;padding:3px 8px;border-radius:6px;font-size:.68rem;font-weight:700;font-family:'JetBrains Mono',monospace;}
.pl2-saldo-badge.deve{background:rgba(239,68,68,.08);border:1px solid rgba(239,68,68,.15);color:#ef4444;}
.pl2-saldo-badge.receber{background:rgba(96,165,250,.08);border:1px solid rgba(96,165,250,.15);color:#60a5fa;}
.pl2-saldo-badge.quitado{background:rgba(16,185,129,.08);border:1px solid rgba(16,185,129,.15);color:#10b981;}
/* Level 3 subtle */
.v2-subtle{color:var(--t3)!important;font-size:.7rem!important;}

/* Agent summary footer */
tr.ag2-footer td{background:rgba(240,180,41,.06);border-bottom:2px solid rgba(240,180,41,.15);padding:0;}
tr.ag2-footer.hidden{display:none;}
.ag2-summary{display:flex;gap:16px;padding:10px 14px 10px 32px;flex-wrap:wrap;align-items:center;}
.ag2-sum-item{text-align:center;}
.ag2-sum-lbl{font-size:.55rem;font-weight:700;text-transform:uppercase;letter-spacing:.7px;color:var(--t3);margin-bottom:2px;}
.ag2-sum-val{font-family:'JetBrains Mono',monospace;font-size:.78rem;font-weight:700;}
.ag2-sum-sep{width:1px;height:28px;background:var(--b2);flex-shrink:0;}

.cs{text-align:center;padding:50px 20px;color:var(--t3);}
.cs .ci{font-size:2.5rem;margin-bottom:12px;}
.cs h3{font-size:.92rem;color:var(--t2);margin-bottom:7px;}
.cs p{font-size:.8rem;line-height:1.6;}
.cs-badge{display:inline-block;margin-top:12px;background:var(--gold-d);color:var(--gold);border:1px solid rgba(240,180,41,.25);padding:5px 14px;border-radius:17px;font-size:.7rem;font-weight:600;}

/* MODALS */
.mo{position:fixed;inset:0;background:rgba(0,0,0,.65);z-index:200;display:none;align-items:center;justify-content:center;backdrop-filter:blur(4px);}
.mo.open{display:flex;animation:fadeIn .2s ease;}
.modal{background:var(--s1);border:1px solid var(--b2);border-radius:16px;padding:24px;width:460px;max-width:92vw;max-height:90vh;overflow-y:auto;}
.modal-title{font-size:1rem;font-weight:700;margin-bottom:5px;}
.modal-sub{font-size:.81rem;color:var(--t2);margin-bottom:18px;}
.modal-lbl{font-size:.68rem;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--t3);margin-bottom:8px;}
.pi{background:var(--s2);border:1px solid var(--b1);border-radius:9px;padding:11px 14px;margin-bottom:16px;}
.pi-id{font-family:'JetBrains Mono',monospace;font-size:.84rem;color:var(--gold);font-weight:600;}
.pi-nick{font-size:.79rem;color:var(--t2);margin-top:3px;}
.pi-agent{font-size:.73rem;color:var(--t3);margin-top:2px;}
.co-grid{display:grid;grid-template-columns:1fr 1fr;gap:7px;margin-bottom:18px;}
.co{background:var(--s2);border:2px solid var(--b1);border-radius:9px;padding:9px 12px;cursor:pointer;transition:all .15s;display:flex;align-items:center;gap:8px;font-size:.82rem;font-weight:600;color:var(--t2);}
.co:hover{border-color:var(--b2);color:var(--t1);}
.co.sel{border-color:var(--gold);background:var(--gold-d);color:var(--gold);}
.ma{display:flex;gap:8px;justify-content:flex-end;}
.btn-cancel{background:transparent;border:1px solid var(--b2);color:var(--t2);padding:8px 17px;border-radius:8px;font-family:'Outfit',sans-serif;font-size:.82rem;cursor:pointer;transition:all .2s;}
.btn-cancel:hover{border-color:var(--t2);color:var(--t1);}
.btn-confirm{background:linear-gradient(135deg,var(--gold),#c47d00);color:#000;border:none;padding:8px 20px;border-radius:8px;font-family:'Outfit',sans-serif;font-weight:700;font-size:.82rem;cursor:pointer;}

#toast{position:fixed;bottom:20px;right:20px;background:var(--s2);border:1px solid var(--green);color:var(--green);padding:10px 17px;border-radius:9px;font-size:.8rem;font-weight:600;transform:translateY(70px);opacity:0;transition:all .3s;z-index:999;}
#toast.show{transform:translateY(0);opacity:1;}
#toast.err{border-color:var(--red);color:var(--red);}

/* STEP PAGES */
.page{display:none;}
.page.active{display:block;animation:fadeIn .3s ease;}

/* ══════ HAMBURGER ══════ */
.hamburger-btn{display:none;background:none;border:1px solid var(--b1);color:var(--t1);font-size:1.2rem;padding:4px 8px;border-radius:6px;cursor:pointer;}
.sidebar-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:49;}

/* ══════ RESPONSIVE ══════ */

/* Tablet */
@media(max-width:1024px){
  .kpi-row{grid-template-columns:repeat(2,1fr)!important;}
}

/* Mobile */
@media(max-width:768px){
  .hamburger-btn{display:block;}
  .sidebar{transform:translateX(-100%);transition:transform .25s ease;}
  .sidebar.open{transform:translateX(0);}
  .sidebar-overlay.open{display:block;}
  .main{margin-left:0!important;}
  .topbar{padding:10px 14px!important;}
  .topbar-title{font-size:.82rem!important;}
  .content{padding:12px!important;}
  .kpi-row{grid-template-columns:1fr 1fr!important;gap:8px!important;}

  /* Tables scroll horizontally */
  table{display:block;overflow-x:auto;white-space:nowrap;-webkit-overflow-scrolling:touch;}
  thead,tbody,tfoot,tr{display:table;width:100%;table-layout:auto;}
  .dn-tabs{flex-wrap:wrap;gap:2px;}
  .dn-tabs .dn-item{font-size:.62rem;padding:6px 8px;}
  .dc-header{flex-direction:column;gap:10px;align-items:flex-start!important;}
  .dc-actions{width:100%;justify-content:flex-start!important;flex-wrap:wrap;}

  .comp-row{flex-wrap:wrap;gap:8px;}
  .comp-left{min-width:unset;width:100%;}
  .comp-vals{width:100%;justify-content:space-between;}
  .comp-actions{width:100%;justify-content:flex-end;}

  /* Config */
  .cfg-card{flex-direction:column!important;align-items:flex-start!important;}

  /* Week chips scroll */
  .week-chips{overflow-x:auto;flex-wrap:nowrap!important;-webkit-overflow-scrolling:touch;padding-bottom:4px;}

  /* Overview cards */
  .club-cards{grid-template-columns:1fr!important;}

  /* Modals full-width */
  .modal{width:96vw!important;max-width:96vw!important;margin:2vh auto!important;}

  /* Fech dashboard grid */
  .fech-club-grid{grid-template-columns:1fr!important;}

  /* Hide topbar-right on very small */
  .topbar-right span{display:none;}
}

/* Small phone */
@media(max-width:480px){
  .kpi-row{grid-template-columns:1fr!important;}
  .km{min-width:unset!important;}
  .topbar-title span{display:none;}
}
</style>
</head>
<body>

<!-- SIDEBAR -->
<aside class="sidebar">
  <div class="sb-logo">
    <div class="logo-mark">
      <div class="logo-icon">♠</div>
      <div><div class="logo-txt">Poker<span>Manager</span></div></div>
    </div>
  </div>
  <div class="sb-sec">
    <div class="sb-sec-lbl">Navegação</div>
    <div class="nav-item active" id="nav-home" onclick="goPage('import')"><span class="ni">🏠</span> Início / Importar</div>
    <div class="nav-item" id="nav-overview" onclick="goPage('overview')"><span class="ni">📊</span> Visão Geral <span class="nav-badge" id="sb-total">0</span></div>
    <div class="nav-item" id="nav-config" onclick="goPage('config')"><span class="ni">⚙️</span> Configurações</div>
  </div>
  <div class="sb-sec">
    <div class="sb-sec-lbl">Fechamento por Clube</div>
    <div class="nav-item" id="nav-fech-dash" onclick="goPage('fech-dash')" style="font-size:.78rem;"><span class="ni">💼</span> Dashboard <span class="nav-badge" id="sb-fech-status" style="background:var(--gold-d);color:var(--gold);">—</span></div>
    <div class="nav-item" id="nav-imp" onclick="goClube('IMPÉRIO')"><span class="ni">👑</span> Império <span class="nav-badge" id="sb-imp">0</span></div>
    <div class="nav-item" id="nav-con" onclick="goClube('CONFRARIA')"><span class="ni">🎯</span> Confraria <span class="nav-badge" id="sb-con">0</span></div>
    <div class="nav-item" id="nav-3bt" onclick="goClube('3BET')"><span class="ni">🃏</span> 3Bet <span class="nav-badge" id="sb-3bt">0</span></div>
    <div class="nav-item" id="nav-tgp" onclick="goClube('TGP')"><span class="ni">🏆</span> TGP <span class="nav-badge" id="sb-tgp">0</span></div>
    <div class="nav-item" id="nav-ch" onclick="goClube('CH')"><span class="ni">⚡</span> CH <span class="nav-badge" id="sb-ch">0</span></div>
  </div>
  <div class="sb-sec">
    <div class="sb-sec-lbl">Consolidação</div>
    <div class="nav-item" id="nav-lancamentos" onclick="goPage('lancamentos')"><span class="ni">📝</span> Lançamentos</div>
    <div class="nav-item" id="nav-liga-global" onclick="goPage('liga-global')"><span class="ni">🏆</span> Liga Consolidado</div>
    <div class="nav-item" id="nav-caixa-global" onclick="goPage('caixa-global')"><span class="ni">🏦</span> Caixa Geral</div>
  </div>
  <div class="sb-bottom">
    <div class="week-pill-sb" style="cursor:pointer;position:relative;" onclick="toggleWeekDropdown(event)">
      <span class="wlbl">Semana Selecionada ▾</span>
      <span class="wv" id="sb-week">—</span>
      <div id="week-dropdown" style="display:none;position:absolute;bottom:100%;left:0;right:0;background:var(--s1);border:1px solid var(--b1);border-radius:8px;margin-bottom:4px;max-height:280px;overflow-y:auto;box-shadow:0 8px 24px rgba(0,0,0,.4);z-index:999;">
        <div id="week-dropdown-items"></div>
      </div>
    </div>
    <div style="padding:8px 12px;font-size:.67rem;color:var(--t3);display:flex;align-items:center;gap:5px;border-top:1px solid var(--b1);margin-top:4px;">
      <span class="autosave-dot"></span> Configurações salvas automaticamente
    </div>
  </div>
</aside>
<div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleMobileSidebar()"></div>

<!-- MAIN -->
<div class="main">
  <div class="topbar">
    <div style="display:flex;align-items:center;gap:10px;">
      <button class="hamburger-btn" onclick="toggleMobileSidebar()">☰</button>
      <div class="topbar-title">Poker Manager <span>/ <span id="topbarLabel">Importação Geral</span></span></div>
    </div>
    <div class="topbar-right"><div class="status-dot"></div><span style="font-size:.78rem;color:var(--t2)">Sistema Ativo</span></div>
  </div>
  <div class="content">

    <!-- ════ PAGE: IMPORT ════ -->
    <div class="page active" id="page-import">
      <div class="import-hero">
        <div class="import-hero-header">
          <div>
            <div class="import-hero-title">Importação <span>Geral</span></div>
            <div class="import-hero-sub">Importe a planilha completa <strong>uma única vez</strong>.<br>O sistema distribui os jogadores automaticamente para cada clube.</div>
          </div>
          <div id="import-status-badge" style="display:none;background:var(--green-d);border:1px solid rgba(16,185,129,.3);border-radius:10px;padding:9px 14px;text-align:right;">
            <div style="font-size:.65rem;color:var(--t3);text-transform:uppercase;letter-spacing:1px;font-weight:700;">Planilha Carregada</div>
            <div style="font-family:'JetBrains Mono',monospace;font-size:.82rem;color:var(--green);font-weight:600;margin-top:2px;" id="imp-status-file">—</div>
          </div>
        </div>

        <!-- WEEK -->
        <div class="week-section">
          <div class="sec-lbl">1. Selecione a Semana do Fechamento</div>
          <div class="week-row">
            <button class="week-nav-btn" onclick="changeWeek(-1)">‹</button>
            <div class="week-display" id="weekDisplay">—</div>
            <button class="week-nav-btn" onclick="changeWeek(1)">›</button>
          </div>
          <div class="week-chips" id="weekChips"></div>
        </div>

        <!-- DROP -->
        <div class="drop-section">
          <div class="sec-lbl">2. Importe a Planilha Completa (todos os clubes)</div>
          <div class="drop-zone" id="dropZone" onclick="document.getElementById('fileMain').click()">
            <span class="drop-icon" id="dropIcon">📊</span>
            <div class="drop-title" id="dropTitle">Arraste a planilha aqui ou clique para selecionar</div>
            <div class="drop-sub" id="dropSub">Planilha geral com todos os jogadores de todos os clubes</div>
            <div class="drop-formats">.xlsx &nbsp;·&nbsp; .xls &nbsp;·&nbsp; .csv</div>
            <div><label class="drop-btn">📂 Escolher Arquivo</label></div>
          </div>
          <input type="file" id="fileMain" accept=".xlsx,.xls,.csv" style="display:none" onchange="handleFile(this.files[0])">
        </div>

        <!-- MAPPER -->
        <div class="mapper-card" id="mapperCard">
          <div class="mapper-title">⚙️ Mapear Colunas</div>
          <div class="mapper-sub">Confirme quais colunas da planilha correspondem a cada campo. Detectamos automaticamente — ajuste se necessário.</div>
          <div class="cm-grid" id="cmGrid"></div>
          <div style="display:flex;align-items:center;gap:12px;">
            <button class="btn-primary" id="btnProcess" onclick="processImport()">✔ Processar e Distribuir para os Clubes</button>
            <button class="btn-sec" onclick="resetImport()">↺ Cancelar</button>
          </div>
        </div>

      </div><!-- /import-hero -->

      <!-- DIAGNOSTIC PANEL -->
      <div id="diagPanel" style="display:none;background:var(--s1);border:1px solid var(--b1);border-radius:14px;padding:22px;margin-bottom:20px;animation:fadeIn .3s ease;"></div>

      <!-- REGRAS INFO -->
      <div style="background:var(--s1);border:1px solid var(--b1);border-radius:14px;padding:22px;">
        <div style="font-size:.82rem;font-weight:700;color:var(--t2);margin-bottom:14px;text-transform:uppercase;letter-spacing:1px;font-size:.68rem;">📋 Regras de Classificação Automática por Agente</div>
        <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(170px,1fr));gap:10px;">
          <div style="background:var(--s2);border-radius:9px;padding:11px;border:1px solid var(--b1);">
            <span style="font-size:1.2rem">👑</span>
            <div style="font-weight:700;font-size:.82rem;color:var(--gold);margin-top:5px;">Império</div>
            <div style="font-family:'JetBrains Mono',monospace;font-size:.7rem;color:var(--t3);margin-top:4px;line-height:1.7;">AMS...<br>BB AMS...<br>TW...</div>
          </div>
          <div style="background:var(--s2);border-radius:9px;padding:11px;border:1px solid var(--b1);">
            <span style="font-size:1.2rem">⚡</span>
            <div style="font-weight:700;font-size:.82rem;color:#60a5fa;margin-top:5px;">CH</div>
            <div style="font-family:'JetBrains Mono',monospace;font-size:.7rem;color:var(--t3);margin-top:4px;line-height:1.7;">CH...</div>
          </div>
          <div style="background:var(--s2);border-radius:9px;padding:11px;border:1px solid var(--b1);">
            <span style="font-size:1.2rem">🃏</span>
            <div style="font-weight:700;font-size:.82rem;color:#c084fc;margin-top:5px;">3Bet</div>
            <div style="font-family:'JetBrains Mono',monospace;font-size:.7rem;color:var(--t3);margin-top:4px;line-height:1.7;">3BET...</div>
          </div>
          <div style="background:var(--s2);border-radius:9px;padding:11px;border:1px solid var(--b1);">
            <span style="font-size:1.2rem">🎯</span>
            <div style="font-weight:700;font-size:.82rem;color:var(--green);margin-top:5px;">Confraria</div>
            <div style="font-family:'JetBrains Mono',monospace;font-size:.7rem;color:var(--t3);margin-top:4px;line-height:1.7;">CONFRA...</div>
          </div>
          <div style="background:var(--s2);border-radius:9px;padding:11px;border:1px solid var(--b1);">
            <span style="font-size:1.2rem">🏆</span>
            <div style="font-weight:700;font-size:.82rem;color:#fb923c;margin-top:5px;">TGP</div>
            <div style="font-family:'JetBrains Mono',monospace;font-size:.7rem;color:var(--t3);margin-top:4px;line-height:1.7;">TGP...</div>
          </div>
          <div style="background:var(--s2);border-radius:9px;padding:11px;border:1px solid rgba(239,68,68,.2);">
            <span style="font-size:1.2rem">⚠️</span>
            <div style="font-weight:700;font-size:.82rem;color:var(--red);margin-top:5px;">Não Identificado</div>
            <div style="font-size:.72rem;color:var(--t3);margin-top:4px;line-height:1.5;">Vinculação manual após importação</div>
          </div>
        </div>
      </div>

    </div><!-- /page-import -->

    <!-- ════ PAGE: OVERVIEW ════ -->
    <div class="page" id="page-overview">
      <div class="overview-header">
        <div>
          <div class="overview-title">Visão <span>Geral</span></div>
          <div style="font-size:.82rem;color:var(--t2);margin-top:3px;">Todos os clubes · Clique num clube para detalhar</div>
        </div>
        <div style="display:flex;align-items:center;gap:10px;">
          <div class="overview-week" id="ov-week">—</div>
          <button class="btn-sec" style="font-size:.8rem;padding:8px 14px;" onclick="goPage('import')">↺ Nova Importação</button>
        </div>
      </div>

      <div class="overview-kpis">
        <div class="ok-card g"><div class="ok-lbl">Total Jogadores</div><div class="ok-val g" id="ov-total">0</div></div>
        <div class="ok-card gr"><div class="ok-lbl">Rake Geral</div><div class="ok-val gr" id="ov-rake">—</div></div>
        <div class="ok-card r"><div class="ok-lbl">Rakeback Geral</div><div class="ok-val r" id="ov-rb">—</div></div>
        <div class="ok-card b"><div class="ok-lbl">Não Classificados</div><div class="ok-val b" id="ov-unk" style="color:var(--red)">0</div></div>
      </div>

      <div class="clubs-grid" id="clubsGrid"></div>

      <!-- ALL PLAYERS TABLE on overview -->
      <div style="background:var(--s1);border:1px solid var(--b1);border-radius:13px;padding:20px;">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;">
          <div style="font-size:.78rem;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--t3);">Todos os Jogadores</div>
          <div style="display:flex;gap:7px;">
            <input class="search-box" type="text" placeholder="🔍 Buscar..." oninput="filterAll(this.value)" id="srchAll">
            <button class="btn-sm" onclick="exportAll()">⬇ Exportar CSV</button>
          </div>
        </div>
        <div id="unl-bar-ov" class="unl-bar" style="display:none">
          <div class="unl-txt">⚠️ <span id="unl-count-ov">0</span> jogadores sem classificação — clique no badge ⚠ para vincular</div>
          <button class="btn-link-all" onclick="openBulk()">Vincular Todos</button>
        </div>
        <div id="ignored-bar" style="display:none;align-items:center;gap:10px;padding:8px 14px;background:rgba(107,114,128,.08);border:1px solid rgba(107,114,128,.2);border-radius:8px;margin-bottom:8px;flex-wrap:wrap;">
          <div style="font-size:.68rem;color:var(--t2);">🚫 <strong id="ignored-count">0</strong> agente(s) ignorado(s) — jogadores excluídos dos fechamentos</div>
          <button onclick="openIgnoredPanel()" style="font-size:.6rem;padding:3px 10px;border-radius:5px;background:var(--s2);border:1px solid var(--b1);color:var(--t2);cursor:pointer;">Ver / Reativar</button>
        </div>
        <!-- Painel de agentes ignorados (colapsável) -->
        <div id="ignored-panel" style="display:none;background:var(--s2);border:1px solid var(--b1);border-radius:8px;padding:12px 14px;margin-bottom:10px;">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
            <span style="font-size:.7rem;font-weight:700;color:var(--t2);">Agentes Ignorados</span>
            <button onclick="document.getElementById('ignored-panel').style.display='none'" style="font-size:.6rem;background:none;border:none;color:var(--t3);cursor:pointer;">✕ fechar</button>
          </div>
          <div id="ignored-list"></div>
        </div>
        <div class="tw">
          <table class="tbl" style="min-width:960px;">
            <thead><tr>
              <th>Jogador / Agência</th>
              <th>Clube</th>
              <th style="text-align:right">Ganhos</th>
              <th style="text-align:right">Rake</th>
              <th style="text-align:right">Rakeback</th>
              <th style="text-align:right">Resultado Semana</th>
            </tr></thead>
            <tbody id="allBody"></tbody>
          </table>
        </div>
        <div class="pagination"><div class="pg-info" id="allPgInfo">0 registros</div><div class="pg-btns" id="allPgBtns"></div></div>
      </div>
    </div><!-- /page-overview -->

    <!-- ════ PAGE: CONFIGURAÇÕES ════ -->
    <div class="page" id="page-config">
      <div style="max-width:640px;margin:0 auto;">
        <div style="margin-bottom:28px;">
          <div style="font-size:1.3rem;font-weight:800;letter-spacing:-.4px;">⚙️ Configurações <span style="color:var(--gold)">Globais</span></div>
          <div style="font-size:.84rem;color:var(--t2);margin-top:5px;">Regras da Liga, taxas e personalização dos clubes.</div>
        </div>

        <!-- Liga Rules -->
        <div style="background:var(--s1);border:1px solid var(--b1);border-radius:12px;padding:18px 20px;margin-bottom:20px;">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;">
            <div>
              <div style="font-size:.88rem;font-weight:700;color:var(--t1);">🏆 Regras da Liga</div>
              <div style="font-size:.7rem;color:var(--t3);margin-top:2px;">Taxas aplicadas automaticamente nos cálculos de todos os clubes</div>
            </div>
            <button onclick="resetLigaConfig()" style="background:var(--s2);border:1px solid var(--b1);color:var(--t3);padding:4px 10px;border-radius:5px;font-size:.58rem;cursor:pointer;">↻ Reset Padrão</button>
          </div>

          <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;" id="liga-config-grid">
            <!-- rendered by JS -->
          </div>
        </div>

        <!-- Club Logos -->
        <div style="background:var(--s1);border:1px solid var(--b1);border-radius:12px;padding:18px 20px;margin-bottom:20px;">
          <div style="font-size:.88rem;font-weight:700;color:var(--t1);margin-bottom:4px;">🎨 Logos dos Clubes</div>
          <div style="font-size:.7rem;color:var(--t3);margin-bottom:14px;">Aparecem no sidebar, cards, cabeçalhos e comprovantes</div>
          <div style="display:flex;flex-direction:column;gap:10px;" id="config-clubs-list">
            <!-- gerado por JS -->
          </div>
        </div>

        <!-- Backup / Restore -->
        <div style="background:var(--s1);border:1px solid var(--b1);border-radius:12px;padding:18px 20px;margin-bottom:20px;">
          <div style="font-size:.88rem;font-weight:700;color:var(--t1);margin-bottom:4px;">💾 Backup & Restauração</div>
          <div style="font-size:.7rem;color:var(--t3);margin-bottom:14px;">Exporte/importe todo o estado do sistema. Proteja seus dados.</div>

          <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-bottom:14px;">
            <button onclick="backupState()" style="background:rgba(16,185,129,.06);border:1px solid rgba(16,185,129,.15);color:#10b981;padding:14px 10px;border-radius:10px;cursor:pointer;font-size:.72rem;font-weight:700;display:flex;flex-direction:column;align-items:center;gap:6px;">
              <span style="font-size:1.4rem;">💾</span>Backup JSON
            </button>
            <label style="background:rgba(96,165,250,.06);border:1px solid rgba(96,165,250,.15);color:#60a5fa;padding:14px 10px;border-radius:10px;cursor:pointer;font-size:.72rem;font-weight:700;display:flex;flex-direction:column;align-items:center;gap:6px;text-align:center;">
              <span style="font-size:1.4rem;">📂</span>Restaurar JSON
              <input type="file" accept=".json" onchange="restoreState(this)" style="display:none;">
            </label>
            <button onclick="saveLocalSnapshot()" style="background:rgba(240,180,41,.06);border:1px solid rgba(240,180,41,.15);color:var(--gold);padding:14px 10px;border-radius:10px;cursor:pointer;font-size:.72rem;font-weight:700;display:flex;flex-direction:column;align-items:center;gap:6px;">
              <span style="font-size:1.4rem;">🧷</span>Snapshot Local
            </button>
          </div>

          <div id="backup-snapshots-list" style="margin-bottom:8px;"></div>

          <div style="display:flex;align-items:center;gap:6px;">
            <span style="font-size:.58rem;color:var(--t3);" id="backup-info">Schema v—</span>
            <span style="font-size:.58rem;color:var(--t3);">·</span>
            <span style="font-size:.58rem;color:var(--t3);" id="backup-size">—</span>
          </div>
        </div>

        <!-- Danger Zone -->
        <div style="background:rgba(239,68,68,.04);border:1px solid rgba(239,68,68,.1);border-radius:12px;padding:18px 20px;margin-bottom:20px;">
          <div style="font-size:.88rem;font-weight:700;color:#ef4444;margin-bottom:4px;">⚠️ Zona de Perigo</div>
          <div style="font-size:.7rem;color:var(--t3);margin-bottom:14px;">Ações irreversíveis. Faça backup antes.</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap;">
            <button onclick="clearAllData()" style="background:rgba(239,68,68,.08);border:1px solid rgba(239,68,68,.2);color:#ef4444;padding:7px 14px;border-radius:7px;font-size:.68rem;font-weight:700;cursor:pointer;">🗑️ Limpar Todos os Dados</button>
            <button onclick="cleanDeadKeys()" style="background:var(--s2);border:1px solid var(--b1);color:var(--t3);padding:7px 14px;border-radius:7px;font-size:.68rem;cursor:pointer;">🧹 Limpar Chaves Órfãs</button>
          </div>
        </div>

        <div style="background:rgba(240,180,41,.05);border:1px solid rgba(240,180,41,.15);border-radius:11px;padding:14px 16px;font-size:.8rem;color:rgba(240,180,41,.7);line-height:1.6;">
          💡 Todas as configurações são salvas automaticamente no navegador (localStorage).
        </div>
      </div>
    </div><!-- /page-config -->

    <!-- ════ PAGE: LANÇAMENTOS ════ -->
    <div class="page" id="page-lancamentos">
      <div id="lancamentos-content" style="margin:0 auto;">
        <div class="cs"><div class="ci">📝</div><h3>Lançamentos</h3><p>Importe a planilha primeiro.</p></div>
      </div>
    </div>

    <!-- ════ PAGE: LIGA CONSOLIDADO (GLOBAL) ════ -->
    <div class="page" id="page-liga-global">
      <div id="liga-global-content" style="margin:0 auto;">
        <div class="cs"><div class="ci">🏆</div><h3>Liga — Consolidado</h3><p>Importe a planilha primeiro.</p></div>
      </div>
    </div>

    <!-- ════ PAGE: FECHAMENTO DASHBOARD ════ -->
    <div class="page" id="page-fech-dash">
      <div id="fech-dash-content" style="margin:0 auto;">
        <div class="cs"><div class="ci">💼</div><h3>Fechamento por Clube</h3><p>Importe a planilha primeiro.</p></div>
      </div>
    </div>

    <!-- ════ PAGE: CAIXA GERAL ════ -->
    <div class="page" id="page-caixa-global">
      <div id="caixa-global-content" style="margin:0 auto;">
        <div class="cs"><div class="ci">🏦</div><h3>Caixa Geral</h3><p>Importe a planilha primeiro.</p></div>
      </div>
    </div>

    <!-- ════ PAGE: CLUBE DETAIL ════ -->
    <div class="page" id="page-clube">
      <div class="detail-layout">
        <div class="detail-nav">
          <div class="dn-title">Operação</div>
          <div class="dn-item active" onclick="switchDN(this,'dn-resumo')"><span class="ni">📋</span> Resumo do Clube</div>
          <div class="dn-item" onclick="switchDN(this,'dn-detalhamento')"><span class="ni">🔍</span> Detalhamento</div>
          <div class="dn-item" onclick="switchDN(this,'dn-rakeback')"><span class="ni">💸</span> Rakeback</div>
          <div style="margin:8px 0 4px;border-top:1px solid var(--b1);padding-top:8px;">
            <div style="font-size:.55rem;text-transform:uppercase;letter-spacing:1.2px;color:var(--t3);padding:0 10px 4px;font-weight:600;">Fechamentos</div>
          </div>
          <div class="dn-item" onclick="switchDN(this,'dn-jogadores')"><span class="ni">👥</span> Jogadores <span class="dnc" id="dn-count">0</span></div>
          <div class="dn-item" onclick="switchDN(this,'dn-fechamentos')"><span class="ni">💼</span> Liquidação</div>
          <div class="dn-item" onclick="switchDN(this,'dn-agentes')"><span class="ni">🤝</span> Comprovantes</div>
          <div class="dn-item" onclick="switchDN(this,'dn-extrato')"><span class="ni">📊</span> Extrato</div>
          <div style="margin:8px 0 4px;border-top:1px solid var(--b1);padding-top:8px;">
            <div style="font-size:.55rem;text-transform:uppercase;letter-spacing:1.2px;color:var(--t3);padding:0 10px 4px;font-weight:600;">Financeiro</div>
          </div>
          <div class="dn-item" onclick="switchDN(this,'dn-conciliacao')"><span class="ni">🔄</span> Conciliação</div>
          <div class="dn-item" onclick="switchDN(this,'dn-ajustes')"><span class="ni">🏦</span> Ajustes</div>
          <div style="margin:8px 0 4px;border-top:1px solid var(--b1);padding-top:8px;">
            <div style="font-size:.55rem;text-transform:uppercase;letter-spacing:1.2px;color:var(--t3);padding:0 10px 4px;font-weight:600;">Resultado</div>
          </div>
          <div class="dn-item" onclick="switchDN(this,'dn-resultado')"><span class="ni">📊</span> DRE</div>
          <div class="dn-item" onclick="switchDN(this,'dn-liga')"><span class="ni">🏆</span> Liga</div>
          <div style="margin-top:16px;padding-top:13px;border-top:1px solid var(--b1);">
            <button class="btn-primary" style="width:100%;justify-content:center;font-size:.77rem;padding:9px;" onclick="goPage('overview')">← Voltar à Visão Geral</button>
          </div>
        </div>
        <div class="detail-content">
          <div class="dc-header">
            <div class="dc-clube">
              <div class="dc-icon" id="dc-icon">♠</div>
              <div><div class="dc-name" id="dc-name">—</div><div class="dc-week" id="dc-week">—</div></div>
            </div>
            <div class="dc-actions" style="display:flex;align-items:center;gap:8px;flex-wrap:wrap;">
              <div id="dc-lock-btn"></div>
              <button class="btn-sm" onclick="openClubConfig()" style="font-size:.68rem;">⚙️ Config</button>
              <button class="btn-sm" onclick="exportResumoJPG()">📤 Exportar Resumo</button>
              <button class="btn-sm" onclick="exportClub()">⬇ CSV</button>
              <button class="back-btn" onclick="goPage('overview')">← Voltar</button>
            </div>
          </div>

          <!-- RESUMO -->
          <div class="sub-tab active" id="dn-resumo">
            <div id="resumo-content">
              <div class="cs"><div class="ci">📋</div><h3>Importe a planilha primeiro</h3></div>
            </div>
          </div>

          <!-- DETALHAMENTO -->
          <div class="sub-tab" id="dn-detalhamento">
            <div id="det-content">
              <div class="cs"><div class="ci">🔍</div><h3>Importe a planilha primeiro</h3></div>
            </div>
          </div>

          <!-- JOGADORES -->
          <div class="sub-tab" id="dn-jogadores">

            <!-- OPERATION BADGE -->
            <div style="margin-bottom:12px;">
              <span style="display:inline-flex;align-items:center;gap:6px;background:rgba(16,185,129,.06);border:1px solid rgba(16,185,129,.15);padding:5px 12px;border-radius:7px;font-size:.62rem;font-weight:700;color:#10b981;letter-spacing:.5px;">🟢 OPERAÇÃO DA SEMANA</span>
            </div>

            <!-- 5 COMPACT KPIs -->
            <div style="display:grid;grid-template-columns:repeat(5,1fr);gap:8px;margin-bottom:16px;" id="v2-kpis">
              <div style="background:var(--s2);border:1px solid var(--b1);border-radius:8px;padding:10px 12px;border-top:2px solid var(--blue);">
                <div style="font-size:.55rem;font-weight:700;text-transform:uppercase;letter-spacing:.6px;color:var(--t3);margin-bottom:4px;">👥 Jogadores Ativos</div>
                <div style="font-family:'JetBrains Mono',monospace;font-size:1rem;font-weight:800;color:var(--t1);" id="v2k-ativos">—</div>
              </div>
              <div style="background:var(--s2);border:1px solid var(--b1);border-radius:8px;padding:10px 12px;border-top:2px solid var(--gold);">
                <div style="font-size:.55rem;font-weight:700;text-transform:uppercase;letter-spacing:.6px;color:var(--t3);margin-bottom:4px;">📈 Profit/Loss</div>
                <div style="font-size:.48rem;color:var(--t3);margin-bottom:2px;">Ganho/Perda bruta da operação</div>
                <div style="font-family:'JetBrains Mono',monospace;font-size:1rem;font-weight:800;" id="v2k-pl">—</div>
              </div>
              <div style="background:var(--s2);border:1px solid var(--b1);border-radius:8px;padding:10px 12px;border-top:2px solid var(--green);">
                <div style="font-size:.55rem;font-weight:700;text-transform:uppercase;letter-spacing:.6px;color:var(--t3);margin-bottom:4px;">💎 Rake Gerado</div>
                <div style="font-family:'JetBrains Mono',monospace;font-size:1rem;font-weight:800;color:var(--green);" id="v2k-rake">—</div>
              </div>
              <div style="background:var(--s2);border:1px solid var(--b1);border-radius:8px;padding:10px 12px;border-top:2px solid #a3e635;">
                <div style="font-size:.55rem;font-weight:700;text-transform:uppercase;letter-spacing:.6px;color:var(--t3);margin-bottom:4px;">💸 Rakeback Total</div>
                <div style="font-family:'JetBrains Mono',monospace;font-size:1rem;font-weight:800;color:#a3e635;" id="v2k-rb">—</div>
              </div>
              <div style="background:var(--s2);border:1px solid var(--b1);border-radius:8px;padding:10px 12px;border-top:2px solid var(--gold);">
                <div style="font-size:.55rem;font-weight:700;text-transform:uppercase;letter-spacing:.6px;color:var(--t3);margin-bottom:4px;">📊 Resultado Semana</div>
                <div style="font-size:.48rem;color:var(--t3);margin-bottom:2px;">Após rake e rakeback</div>
                <div style="font-family:'JetBrains Mono',monospace;font-size:1rem;font-weight:800;" id="v2k-resultado">—</div>
              </div>
            </div>

            <div class="toolbar">
              <div class="tl">
                <input class="search-box" type="text" placeholder="🔍 Buscar..." oninput="filterClub(this.value)" id="srchClub">
              </div>
              <div class="tr">
                <button class="btn-sm" onclick="exportClub()">⬇ Exportar CSV</button>
              </div>
            </div>
            <div id="unl-bar-club" class="unl-bar" style="display:none">
              <div class="unl-txt">⚠️ <span id="unl-count-club">0</span> jogadores sem classificação</div>
              <button class="btn-link-all" onclick="openBulkClub()">Vincular</button>
            </div>
            <div class="tw">
              <table class="tbl" style="min-width:960px;">
                <thead><tr>
                  <th>Jogador / Agência</th>
                  <th style="text-align:right">Ganhos</th>
                  <th style="text-align:right">Rake</th>
                  <th style="text-align:right">Rakeback</th>
                  <th style="text-align:right">Resultado Semana</th>
                  <th style="text-align:right">Saldo Ant.</th>
                  <th style="text-align:right">Pagamento</th>
                  <th style="text-align:right">Saldo Atual</th>
                  <th>Situação</th>
                </tr></thead>
                <tbody id="clubBody"></tbody>
              </table>
            </div>
            <div class="pagination"><div class="pg-info" id="clubPgInfo">0 registros</div><div class="pg-btns" id="clubPgBtns"></div></div>
          </div>

          <!-- RAKEBACK -->
          <div class="sub-tab" id="dn-rakeback">
            <!-- Área comum: KPIs + busca + tabs (renderizada por JS) -->
            <div id="rb-common-area">
              <div class="cs"><div class="ci">📂</div><h3>Importe a planilha primeiro</h3></div>
            </div>
            <!-- Panel: Agências -->
            <div id="rb-panel-agencias">
              <div id="rb-summary-content"></div>
            </div>
            <!-- Panel: Jogadores -->
            <div id="rb-panel-diretos" style="display:none;">
              <div id="rb-diretos-content"></div>
            </div>
          </div>

          <!-- FECHAMENTOS (Liquidação) -->
          <div class="sub-tab" id="dn-fechamentos">
            <!-- Header -->
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;flex-wrap:wrap;gap:8px;">
              <div>
                <div style="display:flex;align-items:center;gap:8px;">
                  <span style="font-size:.95rem;font-weight:700;color:var(--t1);">💼 Fechamentos</span>
                  <span style="display:inline-flex;align-items:center;gap:4px;background:rgba(240,180,41,.06);border:1px solid rgba(240,180,41,.15);padding:3px 10px;border-radius:6px;font-size:.55rem;font-weight:700;color:var(--gold);letter-spacing:.5px;">LIQUIDAÇÃO</span>
                </div>
                <div style="font-size:.72rem;color:var(--t3);margin-top:3px;">Controle de quem pagou, quem recebeu e o que está pendente</div>
              </div>
            </div>

            <!-- Dynamic content rendered by JS -->
            <div id="fech-full-content">
              <div class="cs"><div class="ci">💼</div><h3>Importe a planilha primeiro</h3></div>
            </div>
          </div>

          <!-- AGENTES -->
          <div class="sub-tab" id="dn-agentes">
            <!-- Header + KPIs -->
            <div style="margin-bottom:16px;">
              <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;flex-wrap:wrap;gap:8px;">
                <div>
                  <div style="font-size:.9rem;font-weight:700;color:var(--t1);">📄 Comprovantes</div>
                  <div style="font-size:.72rem;color:var(--t3);margin-top:2px;">Gere e exporte extratos por agente</div>
                </div>
                <button class="btn-sm" onclick="exportAllAgentsPDF()">📄 Exportar Todos</button>
              </div>
              <div id="comp-kpis" style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:14px;"></div>
              <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
                <input class="search-box" type="text" id="agent-search" placeholder="🔍 Buscar agente..." oninput="filterAgentList(this.value)" style="flex:1;min-width:180px;max-width:360px;">
                <select id="comp-filter-result" onchange="filterAgentList(document.getElementById('agent-search').value)" style="background:var(--s2);border:1px solid var(--b1);color:var(--t1);padding:6px 10px;border-radius:6px;font-size:.7rem;">
                  <option value="all">Resultado: Todos</option>
                  <option value="pagar">A Pagar</option>
                  <option value="receber">A Receber</option>
                  <option value="zero">Sem Movimento</option>
                </select>
              </div>
            </div>

            <!-- Lista de agentes -->
            <div id="agent-closing-list">
              <div class="cs"><div class="ci">📂</div><h3>Importe a planilha primeiro</h3></div>
            </div>
          </div>

          <!-- RESUMO FINANCEIRO -->
          <!-- RESULTADO DO CLUBE -->
          <div class="sub-tab" id="dn-resultado">
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;">
              <div>
                <div style="font-size:.9rem;font-weight:700;color:var(--t1);">📊 DRE do Clube</div>
                <div style="font-size:.72rem;color:var(--t3);margin-top:2px;">Demonstração de Resultado — visão econômica completa da operação</div>
              </div>
            </div>
            <div id="resultado-clube-content">
              <div class="cs"><div class="ci">📊</div><h3>Importe a planilha primeiro</h3></div>
            </div>
          </div>

          <!-- CONSOLIDAÇÃO LIGA -->
          <div class="sub-tab" id="dn-liga">
            <div id="liga-content">
              <div class="cs"><div class="ci">🏆</div><h3>Consolidação Liga</h3><p>Importe a planilha primeiro</p></div>
            </div>
          </div>

          <!-- FINANCEIRO -->
          <!-- EXTRATO (read-only history) -->
          <div class="sub-tab" id="dn-extrato">
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;flex-wrap:wrap;gap:10px;">
              <div>
                <div style="font-size:.9rem;font-weight:700;color:var(--t1);">📊 Extrato</div>
                <div style="font-size:.72rem;color:var(--t3);margin-top:2px;">Histórico de movimentações e pagamentos registrados</div>
              </div>
            </div>
            <div style="background:rgba(240,180,41,.05);border:1px solid rgba(240,180,41,.12);border-radius:8px;padding:8px 14px;margin-bottom:14px;display:flex;align-items:center;gap:10px;">
              <span style="font-size:.78rem;">💼</span>
              <span style="font-size:.72rem;color:var(--t2);">Pagamentos e acertos são registrados na aba <strong style="color:var(--gold);">Liquidação</strong></span>
              <button onclick="document.querySelectorAll('.dn-item').forEach(i=>{if(i.textContent.includes('Liquidação'))i.click();});" style="background:rgba(240,180,41,.1);border:1px solid rgba(240,180,41,.25);color:var(--gold);padding:4px 10px;border-radius:6px;font-size:.62rem;font-weight:700;cursor:pointer;margin-left:auto;">Ir para Liquidação →</button>
            </div>
            <!-- Reuses existing fin-content for extrato rendering -->
            <div id="fin-kpi-strip"></div>
            <div id="fin-filters" style="margin-bottom:12px;"></div>
            <div id="fin-content">
              <div class="cs"><div class="ci">📂</div><h3>Importe a planilha primeiro</h3></div>
            </div>
          </div>

          <!-- CONCILIAÇÃO -->
          <div class="sub-tab" id="dn-conciliacao">
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;flex-wrap:wrap;gap:10px;">
              <div>
                <div style="font-size:.9rem;font-weight:700;color:var(--t1);">🔄 Conciliação</div>
                <div style="font-size:.72rem;color:var(--t3);margin-top:2px;">Cruzamento de pagamentos registrados com movimentações bancárias reais</div>
              </div>
            </div>
            <div style="background:rgba(96,165,250,.05);border:1px solid rgba(96,165,250,.1);border-radius:8px;padding:8px 14px;margin-bottom:14px;font-size:.72rem;color:var(--t2);">
              ℹ️ Importe ChipPix ou OFX para cruzar com os pagamentos registrados na Liquidação. Se bater → ✅. Se não → ⚠️.
            </div>
            <div class="conc-tabs" style="margin-bottom:14px;">
              <button class="conc-tab active" onclick="switchConcSub('chippix',this)">🎰 ChipPix</button>
              <button class="conc-tab" onclick="switchConcSub('ofx',this)">🏦 OFX (Bancos)</button>
              <button class="conc-tab" onclick="switchConcSub('ledger',this)">📒 Ledger</button>
            </div>
            <div id="conc-chippix" class="conc-panel">
              <div id="conc-cp-content"></div>
            </div>
            <div id="conc-ofx" class="conc-panel" style="display:none;">
              <div id="conc-ofx-content"></div>
            </div>
            <div id="conc-ledger" class="conc-panel" style="display:none;">
              <div id="conc-ledger-content"></div>
            </div>
          </div>

          <!-- AJUSTES (Financial Config) -->
          <div class="sub-tab" id="dn-ajustes">
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;flex-wrap:wrap;gap:10px;">
              <div>
                <div style="font-size:.9rem;font-weight:700;color:var(--t1);">🏦 Ajustes</div>
                <div style="font-size:.72rem;color:var(--t3);margin-top:2px;">Contas bancárias, formas de pagamento e configurações financeiras do clube</div>
              </div>
            </div>
            <div class="conc-tabs" style="margin-bottom:14px;">
              <button class="conc-tab active" onclick="switchAjustesSub('contas',this)">🏦 Contas Bancárias</button>
              <button class="conc-tab" onclick="switchAjustesSub('formas',this)">💳 Formas de Pagamento</button>
              <button class="conc-tab" onclick="switchAjustesSub('categorias',this)">🏷️ Categorias OFX</button>
            </div>
            <div id="ajustes-panel-contas">
              <div id="conc-banks-content"></div>
            </div>
            <div id="ajustes-panel-formas" style="display:none;">
              <div id="ajustes-formas-content">
                <div class="cs"><div class="ci">💳</div><h3>Formas de pagamento configuradas</h3></div>
              </div>
            </div>
            <div id="ajustes-panel-categorias" style="display:none;">
              <div id="ajustes-categorias-content"></div>
            </div>
          </div>
        </div>
      </div>
    </div><!-- /page-clube -->

  </div><!-- /content -->
</div><!-- /main -->

<!-- MODAL PAGAMENTO -->
<div class="mo" id="mPagamento">
  <div class="modal" style="width:480px;">
    <div class="modal-title">💳 Registrar Pagamento</div>
    <div id="mpag-info" style="background:var(--s2);border-radius:9px;padding:12px 14px;margin-bottom:16px;font-size:.82rem;"></div>
    <div class="modal-lbl">Valor pago</div>
    <div style="display:flex;align-items:center;gap:8px;margin-bottom:14px;">
      <span style="font-size:.8rem;color:var(--t3);font-weight:600;">R$</span>
      <input type="number" step="0.01" id="mpag-valor" placeholder="0,00"
        style="flex:1;background:var(--s2);border:1px solid var(--b2);color:var(--t1);border-radius:8px;padding:9px 12px;font-family:'JetBrains Mono',monospace;font-size:.9rem;">
      <button onclick="setPayFull()" style="background:var(--s2);border:1px solid var(--b2);color:var(--t2);padding:8px 12px;border-radius:8px;font-size:.72rem;cursor:pointer;white-space:nowrap;">Valor Total</button>
    </div>
    <div class="modal-lbl">Forma de pagamento</div>
    <div id="mpag-metodos" style="display:flex;flex-wrap:wrap;gap:7px;margin-bottom:14px;"></div>
    <div class="modal-lbl">Comprovante <span style="color:var(--t3);font-weight:400;">(opcional)</span></div>
    <div style="display:flex;gap:8px;margin-bottom:16px;">
      <input type="text" id="mpag-comp-txt" placeholder="Chave PIX, ID transação, obs..." 
        style="flex:1;background:var(--s2);border:1px solid var(--b2);color:var(--t1);border-radius:8px;padding:8px 12px;font-size:.8rem;">
      <label style="background:var(--s2);border:1px solid var(--b2);color:var(--t2);padding:8px 12px;border-radius:8px;font-size:.72rem;cursor:pointer;white-space:nowrap;">
        📎 Foto
        <input type="file" accept="image/*" id="mpag-comp-img" style="display:none;" onchange="previewComp(this)">
      </label>
    </div>
    <div id="mpag-comp-preview" style="display:none;margin-bottom:14px;"></div>
    <div class="ma">
      <button class="btn-cancel" onclick="closeM('mPagamento')">Cancelar</button>
      <button class="btn-primary" onclick="confirmarPagamento()">✓ Confirmar Pagamento</button>
    </div>
  </div>
</div>

<!-- MODAL FORMAS DE PAGAMENTO -->
<div class="mo" id="mPayMethods">
  <div class="modal" style="width:400px;">
    <div class="modal-title">⚙️ Formas de Pagamento</div>
    <div id="mpay-list" style="margin-bottom:14px;"></div>
    <div style="display:flex;gap:8px;">
      <input type="text" id="mpay-new" placeholder="Nova forma (ex: Transferência)" 
        style="flex:1;background:var(--s2);border:1px solid var(--b2);color:var(--t1);border-radius:8px;padding:8px 12px;font-size:.8rem;">
      <button class="btn-primary" onclick="addNewPayMethod()" style="padding:8px 14px;font-size:.78rem;">+ Adicionar</button>
    </div>
    <div class="ma" style="margin-top:14px;">
      <button class="btn-cancel" onclick="closeM('mPayMethods')">Fechar</button>
    </div>
  </div>
</div>
<div class="mo" id="mLink">
  <div class="modal">
    <div class="modal-title">🔗 Vincular ao Clube</div>
    <div class="modal-sub">Selecione o clube para este jogador:</div>
    <div class="pi">
      <div class="pi-id" id="ml-id">—</div>
      <div class="pi-nick" id="ml-nick">—</div>
      <div class="pi-agent">Agente: <span id="ml-agent" style="color:var(--t2)">—</span></div>
    </div>
    <div class="modal-lbl">Clube</div>
    <div class="co-grid">
      <div class="co" data-opt="IMPÉRIO" onclick="pickOpt(this)"><span>👑</span> Império</div>
      <div class="co" data-opt="CONFRARIA" onclick="pickOpt(this)"><span>🎯</span> Confraria</div>
      <div class="co" data-opt="3BET" onclick="pickOpt(this)"><span>🃏</span> 3Bet</div>
      <div class="co" data-opt="TGP" onclick="pickOpt(this)"><span>🏆</span> TGP</div>
      <div class="co" data-opt="CH" onclick="pickOpt(this)"><span>⚡</span> CH</div>
    </div>
    <div class="ma">
      <button class="btn-cancel" onclick="closeM('mLink')">Cancelar</button>
      <button class="btn-confirm" onclick="confirmLink()">Confirmar</button>
    </div>
  </div>
</div>

<!-- MODAL BULK LINK -->
<div class="mo" id="mBulk">
  <div class="modal" style="width:520px;">
    <div class="modal-title">⚠️ Vincular Não Classificados</div>
    <div class="modal-sub" id="bulkSub">—</div>
    <div id="bulkList" style="max-height:360px;overflow-y:auto;margin-bottom:14px;"></div>
    <div class="ma"><button class="btn-cancel" onclick="closeM('mBulk')">Fechar</button></div>
  </div>
</div>

<!-- HISTORY DRAWER -->
<div class="fin-drawer-overlay" id="finDrawerOverlay" onclick="closeHistoryDrawer()"></div>
<div class="fin-drawer" id="finDrawer">
  <div class="fin-drawer-head">
    <div>
      <div id="fd-title" style="font-weight:700;font-size:.9rem;color:var(--t1);">Histórico</div>
      <div id="fd-subtitle" style="font-size:.68rem;color:var(--t3);margin-top:2px;">—</div>
    </div>
    <button class="fin-drawer-close" onclick="closeHistoryDrawer()">✕</button>
  </div>
  <div class="fin-drawer-body" id="fd-body"></div>
  <div class="fin-drawer-foot" id="fd-foot"></div>
</div>

<!-- PDF PREVIEW MODAL -->
<div class="mo" id="pdf-modal">
  <div class="modal" style="width:720px;padding:0;background:var(--s1);">
    <div style="display:flex;align-items:center;justify-content:space-between;padding:16px 20px;border-bottom:1px solid var(--b1);">
      <div style="font-weight:700;font-size:.95rem;">📄 Comprovante do Agente</div>
      <div style="display:flex;gap:8px;">
        <button onclick="downloadAgentImage()" class="btn-primary" style="font-size:.78rem;padding:7px 16px;">⬇ Salvar JPG</button>
        <button onclick="closeM('pdf-modal')" class="btn-cancel" style="font-size:.78rem;padding:7px 14px;">✕ Fechar</button>
      </div>
    </div>
    <!-- O documento renderizado fica aqui -->
    <div style="padding:16px;overflow-y:auto;max-height:80vh;">
      <div id="pdf-doc-render"></div>
    </div>
  </div>
</div>

<!-- RESUMO EXPORT MODAL -->
<div class="mo" id="resumo-modal">
  <div class="modal" style="width:880px;max-width:96vw;padding:0;background:var(--s1);">
    <div style="display:flex;align-items:center;justify-content:space-between;padding:16px 20px;border-bottom:1px solid var(--b1);">
      <div style="font-weight:700;font-size:.95rem;">📤 Resumo do Fechamento</div>
      <div style="display:flex;gap:8px;">
        <button onclick="downloadResumoJPG()" class="btn-primary" style="font-size:.78rem;padding:7px 16px;">⬇ Salvar JPG</button>
        <button onclick="closeM('resumo-modal')" class="btn-cancel" style="font-size:.78rem;padding:7px 14px;">✕ Fechar</button>
      </div>
    </div>
    <div style="padding:16px;overflow-y:auto;max-height:85vh;background:#e5e7eb;">
      <div id="resumo-doc-render" style="display:flex;justify-content:center;"></div>
    </div>
  </div>
</div>

<!-- MODAL EXTRATO DO PAGAMENTO -->
<div class="mo" id="mExtratoPag">
  <div class="modal" style="width:420px;">
    <div class="modal-title">🧾 Extrato do Pagamento</div>
    <div id="mextrato-body"></div>
    <div class="ma" style="margin-top:16px;">
      <button class="btn-cancel" onclick="closeM('mExtratoPag')">Fechar</button>
    </div>
  </div>
</div>

<!-- MODAL CONFIRMAR EXCLUSÃO -->
<div class="mo" id="mConfirmExcluir">
  <div class="modal" style="width:380px;">
    <div class="modal-title" style="color:#ef4444;">⚠️ Confirmar Exclusão</div>
    <div id="mconfirm-body" style="font-size:.84rem;color:var(--t2);margin-bottom:20px;line-height:1.6;"></div>
    <div class="ma">
      <button class="btn-cancel" onclick="closeM('mConfirmExcluir')">Cancelar</button>
      <button id="mconfirm-ok" class="btn-primary" style="background:linear-gradient(135deg,#ef4444,#dc2626);">🗑 Excluir</button>
    </div>
  </div>
</div>

<!-- MODAL CONCILIAÇÃO OFX -->
<div class="mo" id="mOFX">
  <div class="modal" style="width:860px;max-width:96vw;max-height:90vh;display:flex;flex-direction:column;padding:0;overflow:hidden;">

    <!-- Header fixo -->
    <div style="padding:16px 24px 14px;border-bottom:1px solid var(--b1);flex-shrink:0;">
      <div style="display:flex;align-items:center;justify-content:space-between;">
        <div>
          <div class="modal-title" style="margin:0;">🏦 Conciliação Bancária — OFX</div>
          <div style="font-size:.72rem;color:var(--t3);margin-top:2px;">Vincule lançamentos bancários aos agentes. Tudo fica salvo até você aplicar.</div>
        </div>
        <div style="display:flex;align-items:center;gap:8px;">
          <label style="display:inline-flex;align-items:center;gap:6px;background:rgba(59,130,246,.12);border:1px solid rgba(59,130,246,.28);color:#60a5fa;padding:7px 14px;border-radius:8px;cursor:pointer;font-size:.75rem;font-weight:700;">
            ➕ Adicionar OFX
            <input type="file" accept=".ofx,.OFX" multiple onchange="processOFX(this)" style="display:none;">
          </label>
          <button onclick="closeM('mOFX')" style="background:none;border:none;color:var(--t3);font-size:1.2rem;cursor:pointer;line-height:1;padding:4px;">✕</button>
        </div>
      </div>

      <!-- Abas de bancos carregados -->
      <div id="ofx-bank-tabs" style="display:flex;gap:6px;margin-top:12px;flex-wrap:wrap;"></div>
    </div>

    <!-- Área principal: empty state OU tabela -->
    <div id="ofx-empty" style="padding:40px 24px;text-align:center;flex-shrink:0;">
      <div style="width:64px;height:64px;border-radius:14px;background:rgba(59,130,246,.08);border:2px dashed rgba(59,130,246,.25);display:flex;align-items:center;justify-content:center;font-size:1.8rem;margin:0 auto 14px;">🏦</div>
      <div style="font-size:.86rem;font-weight:700;color:var(--t1);margin-bottom:6px;">Nenhum extrato carregado</div>
      <div style="font-size:.74rem;color:var(--t3);">Clique em <strong style="color:#60a5fa;">➕ Adicionar OFX</strong> para importar seu extrato bancário.<br>Você pode adicionar extratos de vários bancos ao mesmo tempo.</div>
    </div>

    <div id="ofx-main" style="display:none;flex-direction:column;overflow:hidden;flex:1;min-height:0;">

      <!-- Resumo dos bancos -->
      <div id="ofx-summary" style="padding:10px 24px;background:var(--s2);border-bottom:1px solid var(--b1);display:flex;gap:20px;flex-wrap:wrap;flex-shrink:0;align-items:center;"></div>

      <!-- Filtros -->
      <div style="padding:8px 24px;border-bottom:1px solid var(--b1);display:flex;gap:6px;align-items:center;flex-shrink:0;">
        <span style="font-size:.68rem;color:var(--t3);margin-right:2px;">Mostrar:</span>
        <button class="ofx-filter active" data-f="todos"     onclick="filtrarOFX(this,'todos')">Todos</button>
        <button class="ofx-filter"        data-f="vinculado" onclick="filtrarOFX(this,'vinculado')">✅ Vinculados</button>
        <button class="ofx-filter"        data-f="aplicado"  onclick="filtrarOFX(this,'aplicado')">💳 Aplicados</button>
        <button class="ofx-filter"        data-f="pendente"  onclick="filtrarOFX(this,'pendente')">⏳ Pendentes</button>
        <button class="ofx-filter"        data-f="ignorado"  onclick="filtrarOFX(this,'ignorado')">🚫 Ignorados</button>
        <div style="margin-left:auto;font-size:.7rem;color:var(--t3);" id="ofx-match-count"></div>
      </div>

      <!-- Tabela -->
      <div style="overflow-y:auto;flex:1;padding:0 24px 12px;">
        <table style="width:100%;border-collapse:collapse;margin-top:10px;">
          <thead style="position:sticky;top:0;z-index:2;">
            <tr style="background:var(--s2);">
              <th style="padding:7px 10px;text-align:left;font-size:.6rem;font-weight:700;text-transform:uppercase;letter-spacing:.8px;color:var(--t3);">Data</th>
              <th style="padding:7px 10px;text-align:left;font-size:.6rem;font-weight:700;text-transform:uppercase;letter-spacing:.8px;color:var(--t3);">Banco · Descrição</th>
              <th style="padding:7px 10px;text-align:right;font-size:.6rem;font-weight:700;text-transform:uppercase;letter-spacing:.8px;color:var(--t3);">Valor</th>
              <th style="padding:7px 10px;text-align:left;font-size:.6rem;font-weight:700;text-transform:uppercase;letter-spacing:.8px;color:var(--t3);min-width:190px;">Vincular a</th>
              <th style="padding:7px 10px;text-align:center;font-size:.6rem;font-weight:700;text-transform:uppercase;letter-spacing:.8px;color:var(--t3);">Ação</th>
            </tr>
          </thead>
          <tbody id="ofx-tbody"></tbody>
        </table>
      </div>

      <!-- Footer -->
      <div style="padding:12px 24px;border-top:1px solid var(--b1);display:flex;align-items:center;justify-content:space-between;flex-shrink:0;background:var(--s1);">
        <div style="display:flex;align-items:center;gap:12px;">
          <div style="font-size:.74rem;color:var(--t3);" id="ofx-footer-info"></div>
          <button onclick="limparOFXAplicados()" style="background:none;border:none;color:var(--t3);font-size:.7rem;cursor:pointer;padding:0;text-decoration:underline;">🗑 Limpar aplicados</button>
        </div>
        <div style="display:flex;gap:8px;">
          <button class="btn-cancel" onclick="closeM('mOFX')">Fechar</button>
          <button class="btn-primary" onclick="confirmarConciliacao()" id="ofx-btn-confirmar" disabled style="opacity:.5;cursor:not-allowed;">
            ✅ Aplicar Vinculados
          </button>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- MODAL CONCILIAÇÃO CHIPPIX -->
<div class="mo" id="mChipPix">
  <div class="modal" style="width:900px;max-width:96vw;max-height:92vh;display:flex;flex-direction:column;padding:0;overflow:hidden;">

    <!-- Header -->
    <div style="padding:16px 24px 12px;border-bottom:1px solid var(--b1);flex-shrink:0;">
      <div style="display:flex;align-items:center;justify-content:space-between;">
        <div>
          <div class="modal-title" style="margin:0;color:#34d399;">🎰 Conciliação ChipPix</div>
          <div style="font-size:.72rem;color:var(--t3);margin-top:2px;">Importe o extrato Excel do ChipPix. IDs são vinculados automaticamente nas próximas semanas.</div>
        </div>
        <div style="display:flex;align-items:center;gap:8px;">
          <button onclick="reautolinkCP()" style="display:inline-flex;align-items:center;gap:6px;background:rgba(16,185,129,.06);border:1px solid rgba(16,185,129,.18);color:#6ee7b7;padding:7px 12px;border-radius:8px;cursor:pointer;font-size:.72rem;font-weight:600;">
            🔗 Re-vincular por ID
          </button>
          <label style="display:inline-flex;align-items:center;gap:6px;background:rgba(16,185,129,.1);border:1px solid rgba(16,185,129,.28);color:#34d399;padding:7px 14px;border-radius:8px;cursor:pointer;font-size:.75rem;font-weight:700;">
            📂 Importar Excel ChipPix
            <input type="file" accept=".xlsx,.xls" onchange="processChipPix(this)" style="display:none;">
          </label>
          <button onclick="closeM('mChipPix')" style="background:none;border:none;color:var(--t3);font-size:1.2rem;cursor:pointer;line-height:1;padding:4px;">✕</button>
        </div>
      </div>
    </div>

    <!-- Info banner sobre lógica -->
    <div style="padding:8px 24px;background:rgba(16,185,129,.04);border-bottom:1px solid rgba(16,185,129,.1);flex-shrink:0;display:flex;gap:24px;flex-wrap:wrap;">
      <div style="font-size:.72rem;color:var(--t3);">📥 <strong style="color:#34d399;">Entrada bruta</strong> = Jogador depositou chips (pagou ao clube)</div>
      <div style="font-size:.72rem;color:var(--t3);">📤 <strong style="color:#f87171;">Saída bruta</strong> = Jogador sacou chips (clube pagou ao jogador)</div>
      <div style="font-size:.72rem;color:var(--t3);">💡 <strong style="color:var(--t2);">Saldo</strong> = Entrada − Saída por ID de jogador</div>
    </div>

    <!-- Empty state -->
    <div id="cp-empty" style="padding:40px 24px;text-align:center;">
      <div style="width:64px;height:64px;border-radius:14px;background:rgba(16,185,129,.08);border:2px dashed rgba(16,185,129,.25);display:flex;align-items:center;justify-content:center;font-size:1.8rem;margin:0 auto 14px;">🎰</div>
      <div style="font-size:.86rem;font-weight:700;color:var(--t1);margin-bottom:6px;">Nenhum extrato ChipPix carregado</div>
      <div style="font-size:.74rem;color:var(--t3);">Clique em <strong style="color:#34d399;">📂 Importar Excel ChipPix</strong> para carregar o extrato.<br>Os IDs dos jogadores são vinculados automaticamente após o primeiro mapeamento.</div>
    </div>

    <!-- Área principal -->
    <div id="cp-main" style="display:none;flex-direction:column;overflow:hidden;flex:1;min-height:0;">

      <!-- KPIs resumo -->
      <div id="cp-summary" style="padding:10px 24px;background:var(--s2);border-bottom:1px solid var(--b1);display:flex;gap:22px;flex-wrap:wrap;flex-shrink:0;align-items:center;"></div>

      <!-- Filtros -->
      <div style="padding:8px 24px;border-bottom:1px solid var(--b1);display:flex;gap:6px;align-items:center;flex-shrink:0;flex-wrap:wrap;">
        <span style="font-size:.68rem;color:var(--t3);">Mostrar:</span>
        <button class="cp-filter active" data-f="todos"     onclick="filtrarCP(this,'todos')">Todos</button>
        <button class="cp-filter"        data-f="vinculado" onclick="filtrarCP(this,'vinculado')">✅ Vinculados</button>
        <button class="cp-filter"        data-f="aplicado"  onclick="filtrarCP(this,'aplicado')">💳 Aplicados</button>
        <button class="cp-filter"        data-f="pendente"  onclick="filtrarCP(this,'pendente')">⏳ Pendentes</button>
        <button class="cp-filter"        data-f="ignorado"  onclick="filtrarCP(this,'ignorado')">🚫 Ignorados</button>
        <div style="margin-left:auto;display:flex;align-items:center;gap:8px;">
          <div style="position:relative;">
            <span style="position:absolute;left:8px;top:50%;transform:translateY(-50%);font-size:.72rem;color:var(--t3);pointer-events:none;">🔍</span>
            <input id="cp-search" type="text" placeholder="Buscar por ID ou nome..." oninput="renderCPTable()"
              style="background:var(--s2);border:1px solid var(--b2);color:var(--t1);padding:5px 10px 5px 26px;border-radius:7px;font-size:.72rem;width:200px;outline:none;"
              onfocus="this.style.borderColor='rgba(16,185,129,.5)'" onblur="this.style.borderColor='var(--b2)'">
          </div>
          <div style="font-size:.7rem;color:var(--t3);white-space:nowrap;" id="cp-match-count"></div>
        </div>
      </div>

      <!-- Tabela -->
      <div style="overflow-y:auto;flex:1;padding:0 24px 12px;">
        <table style="width:100%;border-collapse:collapse;margin-top:10px;">
          <thead style="position:sticky;top:0;z-index:2;">
            <tr style="background:var(--s2);">
              <th style="padding:7px 10px;text-align:left;font-size:.6rem;font-weight:700;text-transform:uppercase;letter-spacing:.8px;color:var(--t3);">ID ChipPix</th>
              <th style="padding:7px 10px;text-align:left;font-size:.6rem;font-weight:700;text-transform:uppercase;letter-spacing:.8px;color:var(--t3);">Nome no ChipPix</th>
              <th style="padding:7px 10px;text-align:right;font-size:.6rem;font-weight:700;text-transform:uppercase;letter-spacing:.8px;color:var(--t3);">📥 Entrada</th>
              <th style="padding:7px 10px;text-align:right;font-size:.6rem;font-weight:700;text-transform:uppercase;letter-spacing:.8px;color:var(--t3);">📤 Saída</th>
              <th style="padding:7px 10px;text-align:right;font-size:.6rem;font-weight:700;text-transform:uppercase;letter-spacing:.8px;color:var(--t3);">Saldo</th>
              <th style="padding:7px 10px;text-align:left;font-size:.6rem;font-weight:700;text-transform:uppercase;letter-spacing:.8px;color:var(--t3);min-width:180px;">Vincular ao jogador</th>
              <th style="padding:7px 10px;text-align:center;font-size:.6rem;font-weight:700;text-transform:uppercase;letter-spacing:.8px;color:var(--t3);">Ação</th>
            </tr>
          </thead>
          <tbody id="cp-tbody"></tbody>
        </table>
      </div>

      <!-- Footer -->
      <div style="padding:12px 24px;border-top:1px solid var(--b1);display:flex;align-items:center;justify-content:space-between;flex-shrink:0;background:var(--s1);">
        <div style="font-size:.74rem;color:var(--t3);" id="cp-footer-info"></div>
        <div style="display:flex;gap:8px;">
          <button class="btn-cancel" onclick="closeM('mChipPix')">Fechar</button>
          <button onclick="resetarChipPixSemana()" title="Apaga os lançamentos ChipPix desta semana para re-aplicar"
            style="background:rgba(239,68,68,.1);border:1px solid rgba(239,68,68,.25);color:#f87171;padding:7px 14px;border-radius:8px;font-size:.78rem;font-weight:600;cursor:pointer;">
            🗑 Limpar lançamentos
          </button>
          <button class="btn-primary" onclick="aplicarChipPix()" id="cp-btn-aplicar" disabled
            style="opacity:.5;cursor:not-allowed;background:linear-gradient(135deg,#10b981,#059669);">
            ✅ Aplicar Vinculados
          </button>
        </div>
      </div>
    </div>

  </div>
</div>

<div id="toast"></div>

<!-- MODAL LOCK CHECKLIST -->
<div class="mo" id="mLockChecklist">
  <div class="modal" style="width:560px;max-width:96vw;">
    <div class="modal-title">🔒 Checklist — Lockar Semana</div>
    <div style="font-size:.72rem;color:var(--t3);margin-bottom:14px;">Verifique os itens antes de confirmar o lock. O snapshot será salvo e os saldos carregados na próxima semana.</div>
    <div id="lock-checklist-items" style="margin-bottom:16px;"></div>
    <div id="lock-checklist-warnings" style="margin-bottom:14px;"></div>
    <div style="display:flex;justify-content:flex-end;gap:8px;">
      <button class="btn-cancel" onclick="closeM('mLockChecklist')">Cancelar</button>
      <button id="lock-checklist-confirm" class="btn-primary" onclick="confirmLockFromChecklist()" style="font-size:.78rem;">🔒 Confirmar Lock</button>
    </div>
  </div>
</div>

<!-- MODAL CLUB CONFIG -->
<div class="mo" id="mClubConfig">
  <div class="modal" style="width:640px;max-width:96vw;max-height:85vh;overflow-y:auto;">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;">
      <div>
        <div class="modal-title" style="margin:0;">⚙️ Configurações do Clube</div>
        <div style="font-size:.72rem;color:var(--t3);margin-top:2px;" id="club-config-subtitle">—</div>
      </div>
      <button onclick="closeM('mClubConfig')" style="background:none;border:none;color:var(--t3);font-size:1.2rem;cursor:pointer;">✕</button>
    </div>
    <div id="club-config-content"></div>
  </div>
</div>

<!-- MODAL IMPORT REPORT -->
<div class="mo" id="mImportReport">
  <div class="modal" style="width:640px;max-width:96vw;max-height:85vh;overflow-y:auto;">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;">
      <div class="modal-title" style="margin:0;">📋 Relatório de Importação</div>
      <button onclick="closeM('mImportReport')" style="background:none;border:none;color:var(--t3);font-size:1.2rem;cursor:pointer;">✕</button>
    </div>
    <div id="import-report-content"></div>
    <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:16px;">
      <button class="btn-cancel" onclick="closeM('mImportReport')">Cancelar</button>
      <button id="import-report-confirm" class="btn-primary" onclick="confirmImportFromReport()" disabled>✅ Aceitar Importação</button>
    </div>
  </div>
</div>

<!-- ══ MÓDULOS EXTERNOS (carregar antes do script principal) ══ -->
<!-- adapterImport.js: NÃO carregado aqui — código inline no script principal ainda ativo.
     Reintegrar após remover o bloco inline (const GU_TO_BRL / adapterImport / resolveClubeInterno). -->
<script src="dataLayer.js"></script>
<script src="financeEngine.js"></script>

<script>
// ══ SELF-CHECK: Blindagem contra corrupção de fórmulas ══
(function() {
  var FE = window.FinanceEngine;
  var ok = true;
  function check(name, got, expected) {
    if (Math.abs(got - expected) > 0.001) {
      ok = false;
      console.error('[FINANCE-ENGINE] FALHA: ' + name + ' — esperado ' + expected + ', obteve ' + got);
    }
  }
  // Teste 1: saldo=100, in=30 → saldo=70
  check('calcSaldoAtual(100,0,30)', FE.calcSaldoAtual(100, 0, 30), 70);
  // Teste 2: saldo=100, out=30 → saldo=130
  check('calcSaldoAtual(100,0,-30)', FE.calcSaldoAtual(100, 0, -30), 130);
  // Teste 3: pendente = -3833 + 3000 = -833
  check('calcPendente(-3833,3000)', FE.calcPendente(-3833, 3000), -833);
  // Teste 4: calcPlayerResult ganhos=-500 rake=100 pct=10 → -490
  check('calcPlayerResult', FE.calcPlayerResult({ganhos:-500,rake:100}, 10), -490);
  // Teste 5: calcLedgerNet
  var ln = FE.calcLedgerNet([{dir:'in',valor:30},{dir:'out',valor:10}]);
  check('calcLedgerNet.net', ln.net, 20);

  if (!ok) {
    alert('ERRO CRITICO: Formulas do FinanceEngine foram corrompidas!\nO sistema pode calcular valores errados.\nVerifique o console para detalhes.');
  }
})();
</script>

<!-- Módulos extraídos (Passo 3) -->
<script src="js/utils.js"></script>
<script src="js/app-state.js"></script>
<script src="js/app-navigation.js"></script>

<!-- Módulos extraídos (Passo 4) -->
<script src="js/import-processor.js"></script>
<script src="js/render-tables.js"></script>
<script src="js/render-rakeback.js"></script>
<script src="js/render-config.js"></script>
<script src="js/render-financeiro.js"></script>
<script src="js/render-reports.js"></script>
<script src="js/render-conciliacao.js"></script>
<script src="js/render-staging.js"></script>
<script src="js/render-agents.js"></script>

<script>
// INIT
window.addEventListener('DOMContentLoaded', ()=>{ applyLogosEverywhere(); });
initWeeks();
</script>
</body>
</html>
